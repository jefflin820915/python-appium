"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.SETTINGS_HELPER_PKG_ID = exports.helpers = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _asyncbox = require("asyncbox");

var _logger = _interopRequireDefault(require("./logger"));

var _appiumSupport = require("appium-support");

var _ioAppium = require("io.appium.settings");

var _bootstrap = _interopRequireDefault(require("./bootstrap"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumAdb = _interopRequireDefault(require("appium-adb"));

var _unlockHelpers = _interopRequireWildcard(require("./unlock-helpers"));

var _os = require("os");

var _semver = _interopRequireDefault(require("semver"));

const PACKAGE_INSTALL_TIMEOUT = 90000;
const CHROME_BROWSER_PACKAGE_ACTIVITY = {
  chrome: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  chromium: {
    pkg: 'org.chromium.chrome.shell',
    activity: '.ChromeShellActivity'
  },
  chromebeta: {
    pkg: 'com.chrome.beta',
    activity: 'com.google.android.apps.chrome.Main'
  },
  browser: {
    pkg: 'com.android.browser',
    activity: 'com.android.browser.BrowserActivity'
  },
  'chromium-browser': {
    pkg: 'org.chromium.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  },
  'chromium-webview': {
    pkg: 'org.chromium.webview_shell',
    activity: 'org.chromium.webview_shell.WebViewBrowserActivity'
  },
  default: {
    pkg: 'com.android.chrome',
    activity: 'com.google.android.apps.chrome.Main'
  }
};
const SETTINGS_HELPER_PKG_ID = 'io.appium.settings';
exports.SETTINGS_HELPER_PKG_ID = SETTINGS_HELPER_PKG_ID;
const SETTINGS_HELPER_UNLOCK_ACTIVITY = '.Unlock';
const EMULATOR_PATTERN = /\bemulator\b/i;
let helpers = {};
exports.helpers = helpers;

helpers.createBaseADB = async function createBaseADB(opts = {}) {
  const {
    adbPort,
    suppressKillServer,
    remoteAdbHost,
    clearDeviceLogsOnStart,
    adbExecTimeout,
    useKeystore,
    keystorePath,
    keystorePassword,
    keyAlias,
    keyPassword,
    remoteAppsCacheLimit,
    buildToolsVersion,
    allowOfflineDevices
  } = opts;
  return await _appiumAdb.default.createADB({
    adbPort,
    suppressKillServer,
    remoteAdbHost,
    clearDeviceLogsOnStart,
    adbExecTimeout,
    useKeystore,
    keystorePath,
    keystorePassword,
    keyAlias,
    keyPassword,
    remoteAppsCacheLimit,
    buildToolsVersion,
    allowOfflineDevices
  });
};

helpers.prepareEmulator = async function prepareEmulator(adb, opts) {
  let {
    avd,
    avdArgs,
    language,
    locale,
    avdLaunchTimeout,
    avdReadyTimeout
  } = opts;

  if (!avd) {
    throw new Error('Cannot launch AVD without AVD name');
  }

  let avdName = avd.replace('@', '');
  let runningAVD = await adb.getRunningAVD(avdName);

  if (runningAVD !== null) {
    if (avdArgs && avdArgs.toLowerCase().indexOf('-wipe-data') > -1) {
      _logger.default.debug(`Killing '${avdName}' because it needs to be wiped at start.`);

      await adb.killEmulator(avdName);
    } else {
      _logger.default.debug('Not launching AVD because it is already running.');

      return;
    }
  }

  avdArgs = this.prepareAVDArgs(opts, adb, avdArgs);
  await adb.launchAVD(avd, avdArgs, language, locale, avdLaunchTimeout, avdReadyTimeout);
};

helpers.prepareAVDArgs = function prepareAVDArgs(opts, adb, avdArgs) {
  let args = avdArgs ? [avdArgs] : [];

  if (!_lodash.default.isUndefined(opts.networkSpeed)) {
    let networkSpeed = this.ensureNetworkSpeed(adb, opts.networkSpeed);
    args.push('-netspeed', networkSpeed);
  }

  if (opts.isHeadless) {
    args.push('-no-window');
  }

  return args.join(' ');
};

helpers.ensureNetworkSpeed = function ensureNetworkSpeed(adb, networkSpeed) {
  if (_lodash.default.values(adb.NETWORK_SPEED).indexOf(networkSpeed) !== -1) {
    return networkSpeed;
  }

  _logger.default.warn(`Wrong network speed param ${networkSpeed}, using default: full. Supported values: ${_lodash.default.values(adb.NETWORK_SPEED)}`);

  return adb.NETWORK_SPEED.FULL;
};

helpers.ensureDeviceLocale = async function ensureDeviceLocale(adb, language, country, script = null) {
  if (!_lodash.default.isString(language) && !_lodash.default.isString(country)) {
    _logger.default.warn(`setDeviceLanguageCountry requires language or country.`);

    _logger.default.warn(`Got language: '${language}' and country: '${country}'`);

    return;
  }

  await adb.setDeviceLanguageCountry(language, country, script);

  if (!(await adb.ensureCurrentLocale(language, country, script))) {
    const message = script ? `language: ${language}, country: ${country} and script: ${script}` : `language: ${language} and country: ${country}`;
    throw new Error(`Failed to set ${message}`);
  }
};

helpers.getDeviceInfoFromCaps = async function getDeviceInfoFromCaps(opts = {}) {
  const adb = await helpers.createBaseADB(opts);
  let udid = opts.udid;
  let emPort = null;

  if (opts.avd) {
    await helpers.prepareEmulator(adb, opts);
    udid = adb.curDeviceId;
    emPort = adb.emulatorPort;
  } else {
    _logger.default.info('Retrieving device list');

    let devices = await adb.getDevicesWithRetry();

    if (udid) {
      if (!_lodash.default.includes(_lodash.default.map(devices, 'udid'), udid)) {
        _logger.default.errorAndThrow(`Device ${udid} was not in the list of connected devices`);
      }

      emPort = adb.getPortFromEmulatorString(udid);
    } else if (opts.platformVersion) {
      opts.platformVersion = `${opts.platformVersion}`.trim();
      const platformVersion = _semver.default.coerce(opts.platformVersion) || opts.platformVersion;

      _logger.default.info(`Looking for a device with Android '${platformVersion}'`);

      const availDevices = [];
      let partialMatchCandidate = null;

      for (const device of devices) {
        await adb.setDeviceId(device.udid);
        const rawDeviceOS = await adb.getPlatformVersion();
        availDevices.push(`${device.udid} (${rawDeviceOS})`);
        const deviceOS = _semver.default.coerce(rawDeviceOS) || rawDeviceOS;

        if (!deviceOS) {
          continue;
        }

        const bothVersionsCanBeCoerced = _semver.default.valid(deviceOS) && _semver.default.valid(platformVersion);

        const bothVersionsAreStrings = _lodash.default.isString(deviceOS) && _lodash.default.isString(platformVersion);

        if (bothVersionsCanBeCoerced && deviceOS.version === platformVersion.version || bothVersionsAreStrings && _lodash.default.toLower(deviceOS) === _lodash.default.toLower(platformVersion)) {
          udid = device.udid;
          break;
        } else if (!bothVersionsCanBeCoerced) {
          continue;
        }

        if ((!_lodash.default.includes(opts.platformVersion, '.') && platformVersion.major === deviceOS.major || platformVersion.major === deviceOS.major && platformVersion.minor === deviceOS.minor) && (partialMatchCandidate && _semver.default.gt(deviceOS, _lodash.default.values(partialMatchCandidate)[0]) || !partialMatchCandidate)) {
          partialMatchCandidate = {
            [device.udid]: deviceOS
          };
        }
      }

      if (!udid && partialMatchCandidate) {
        udid = _lodash.default.keys(partialMatchCandidate)[0];
        await adb.setDeviceId(udid);
      }

      if (!udid) {
        _logger.default.errorAndThrow(`Unable to find an active device or emulator ` + `with OS ${opts.platformVersion}. The following are available: ` + availDevices.join(', '));
      }

      emPort = adb.getPortFromEmulatorString(udid);
    } else {
      udid = devices[0].udid;
      emPort = adb.getPortFromEmulatorString(udid);
    }
  }

  _logger.default.info(`Using device: ${udid}`);

  return {
    udid,
    emPort
  };
};

helpers.createADB = async function createADB(opts = {}) {
  const {
    udid,
    emPort
  } = opts;
  const adb = await helpers.createBaseADB(opts);
  adb.setDeviceId(udid);

  if (emPort) {
    adb.setEmulatorPort(emPort);
  }

  return adb;
};

helpers.validatePackageActivityNames = function validatePackageActivityNames(opts) {
  for (const key of ['appPackage', 'appActivity', 'appWaitPackage', 'appWaitActivity']) {
    const name = opts[key];

    if (!name) {
      continue;
    }

    const match = /([^\w.*,])+/.exec(name);

    if (!match) {
      continue;
    }

    _logger.default.warn(`Capability '${key}' is expected to only include latin letters, digits, underscore, dot, comma and asterisk characters.`);

    _logger.default.warn(`Current value '${name}' has non-matching character at index ${match.index}: '${name.substring(0, match.index + 1)}'`);
  }
};

helpers.getLaunchInfo = async function getLaunchInfo(adb, opts) {
  let {
    app,
    appPackage,
    appActivity,
    appWaitPackage,
    appWaitActivity
  } = opts;

  if (!app) {
    _logger.default.warn('No app sent in, not parsing package/activity');

    return;
  }

  this.validatePackageActivityNames(opts);

  if (appPackage && appActivity) {
    return;
  }

  _logger.default.debug('Parsing package and activity from app manifest');

  let {
    apkPackage,
    apkActivity
  } = await adb.packageAndLaunchActivityFromManifest(app);

  if (apkPackage && !appPackage) {
    appPackage = apkPackage;
  }

  if (!appWaitPackage) {
    appWaitPackage = appPackage;
  }

  if (apkActivity && !appActivity) {
    appActivity = apkActivity;
  }

  if (!appWaitActivity) {
    appWaitActivity = appActivity;
  }

  _logger.default.debug(`Parsed package and activity are: ${apkPackage}/${apkActivity}`);

  return {
    appPackage,
    appWaitPackage,
    appActivity,
    appWaitActivity
  };
};

helpers.resetApp = async function resetApp(adb, opts = {}) {
  const {
    app,
    appPackage,
    fastReset,
    fullReset,
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages
  } = opts;

  if (!appPackage) {
    throw new Error("'appPackage' option is required");
  }

  const isInstalled = await adb.isAppInstalled(appPackage);

  if (isInstalled) {
    try {
      await adb.forceStop(appPackage);
    } catch (ign) {}

    if (!fullReset && fastReset) {
      const output = await adb.clear(appPackage);

      if (_lodash.default.isString(output) && output.toLowerCase().includes('failed')) {
        throw new Error(`Cannot clear the application data of '${appPackage}'. Original error: ${output}`);
      }

      if (autoGrantPermissions) {
        try {
          await adb.grantAllPermissions(appPackage);
        } catch (error) {
          _logger.default.error(`Unable to grant permissions requested. Original error: ${error.message}`);
        }
      }

      _logger.default.debug(`Performed fast reset on the installed '${appPackage}' application (stop and clear)`);

      return;
    }
  }

  if (!app) {
    throw new Error("'app' option is required for reinstall");
  }

  _logger.default.debug(`Running full reset on '${appPackage}' (reinstall)`);

  if (isInstalled) {
    await adb.uninstallApk(appPackage);
  }

  await adb.install(app, {
    grantPermissions: autoGrantPermissions,
    timeout: androidInstallTimeout,
    allowTestPackages
  });
};

helpers.installApk = async function installApk(adb, opts = {}) {
  const {
    app,
    appPackage,
    fastReset,
    fullReset,
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages,
    enforceAppInstall
  } = opts;

  if (!app || !appPackage) {
    throw new Error("'app' and 'appPackage' options are required");
  }

  if (fullReset) {
    await this.resetApp(adb, opts);
    return;
  }

  const {
    appState,
    wasUninstalled
  } = await adb.installOrUpgrade(app, appPackage, {
    grantPermissions: autoGrantPermissions,
    timeout: androidInstallTimeout,
    allowTestPackages,
    enforceCurrentBuild: enforceAppInstall
  });
  const isInstalledOverExistingApp = !wasUninstalled && appState !== adb.APP_INSTALL_STATE.NOT_INSTALLED;

  if (fastReset && isInstalledOverExistingApp) {
    _logger.default.info(`Performing fast reset on '${appPackage}'`);

    await this.resetApp(adb, opts);
  }
};

helpers.installOtherApks = async function installOtherApks(otherApps, adb, opts) {
  let {
    androidInstallTimeout = PACKAGE_INSTALL_TIMEOUT,
    autoGrantPermissions,
    allowTestPackages
  } = opts;
  await _bluebird.default.all(otherApps.map(otherApp => {
    _logger.default.debug(`Installing app: ${otherApp}`);

    return adb.installOrUpgrade(otherApp, null, {
      grantPermissions: autoGrantPermissions,
      timeout: androidInstallTimeout,
      allowTestPackages
    });
  }));
};

helpers.uninstallOtherPackages = async function uninstallOtherPackages(adb, appPackages, filterPackages = []) {
  if (appPackages.includes('*')) {
    _logger.default.debug('Uninstall third party packages');

    appPackages = await this.getThirdPartyPackages(adb, filterPackages);
  }

  _logger.default.debug(`Uninstalling packages: ${appPackages}`);

  await _bluebird.default.all(appPackages.map(appPackage => adb.uninstallApk(appPackage)));
};

helpers.getThirdPartyPackages = async function getThirdPartyPackages(adb, filterPackages = []) {
  try {
    const packagesString = await adb.shell(['pm', 'list', 'packages', '-3']);
    const appPackagesArray = packagesString.trim().replace(/package:/g, '').split(_os.EOL);

    _logger.default.debug(`'${appPackagesArray}' filtered with '${filterPackages}'`);

    return _lodash.default.difference(appPackagesArray, filterPackages);
  } catch (err) {
    _logger.default.warn(`Unable to get packages with 'adb shell pm list packages -3': ${err.message}`);

    return [];
  }
};

helpers.initUnicodeKeyboard = async function initUnicodeKeyboard(adb) {
  _logger.default.debug('Enabling Unicode keyboard support');

  let defaultIME = await adb.defaultIME();

  _logger.default.debug(`Unsetting previous IME ${defaultIME}`);

  const appiumIME = `${SETTINGS_HELPER_PKG_ID}/.UnicodeIME`;

  _logger.default.debug(`Setting IME to '${appiumIME}'`);

  await adb.enableIME(appiumIME);
  await adb.setIME(appiumIME);
  return defaultIME;
};

helpers.setMockLocationApp = async function setMockLocationApp(adb, app) {
  try {
    if ((await adb.getApiLevel()) < 23) {
      await adb.shell(['settings', 'put', 'secure', 'mock_location', '1']);
    } else {
      await adb.shell(['appops', 'set', app, 'android:mock_location', 'allow']);
    }
  } catch (err) {
    _logger.default.warn(`Unable to set mock location for app '${app}': ${err.message}`);
  }
};

helpers.installHelperApp = async function installHelperApp(adb, apkPath, packageId) {
  await (0, _asyncbox.retry)(2, async function retryInstallHelperApp() {
    await adb.installOrUpgrade(apkPath, packageId, {
      grantPermissions: true
    });
  });
};

helpers.pushSettingsApp = async function pushSettingsApp(adb, throwError = false) {
  _logger.default.debug('Pushing settings apk to device...');

  try {
    await helpers.installHelperApp(adb, _ioAppium.path, SETTINGS_HELPER_PKG_ID, throwError);
  } catch (err) {
    if (throwError) {
      throw err;
    }

    _logger.default.warn(`Ignored error while installing '${_ioAppium.path}': ` + `'${err.message}'. Features that rely on this helper ` + 'require the apk such as toggle WiFi and getting location ' + 'will raise an error if you try to use them.');
  }

  if (await adb.processExists(SETTINGS_HELPER_PKG_ID)) {
    _logger.default.debug(`${SETTINGS_HELPER_PKG_ID} is already running. ` + `There is no need to reset its permissions.`);

    return;
  }

  if ((await adb.getApiLevel()) <= 23) {
    const perms = ['SET_ANIMATION_SCALE', 'CHANGE_CONFIGURATION', 'ACCESS_FINE_LOCATION'];

    _logger.default.info(`Granting permissions ${perms} to '${SETTINGS_HELPER_PKG_ID}'`);

    await adb.grantPermissions(SETTINGS_HELPER_PKG_ID, perms.map(x => `android.permission.${x}`));
  }

  try {
    await adb.requireRunningSettingsApp();
  } catch (err) {
    _logger.default.debug(err);

    if (throwError) {
      throw err;
    }
  }
};

helpers.pushStrings = async function pushStrings(language, adb, opts) {
  const remoteDir = '/data/local/tmp';
  const stringsJson = 'strings.json';

  const remoteFile = _path.default.posix.resolve(remoteDir, stringsJson);

  await adb.rimraf(remoteFile);
  let app;

  try {
    app = opts.app || (await adb.pullApk(opts.appPackage, opts.tmpDir));
  } catch (err) {
    _logger.default.info(`Failed to pull an apk from '${opts.appPackage}' to '${opts.tmpDir}'. Original error: ${err.message}`);
  }

  if (_lodash.default.isEmpty(opts.appPackage) || !(await _appiumSupport.fs.exists(app))) {
    _logger.default.debug(`No app or package specified. Returning empty strings`);

    return {};
  }

  const stringsTmpDir = _path.default.resolve(opts.tmpDir, opts.appPackage);

  try {
    _logger.default.debug('Extracting strings from apk', app, language, stringsTmpDir);

    const {
      apkStrings,
      localPath
    } = await adb.extractStringsFromApk(app, language, stringsTmpDir);
    await adb.push(localPath, remoteDir);
    return apkStrings;
  } catch (err) {
    _logger.default.warn(`Could not get strings, continuing anyway. Original error: ${err.message}`);

    await adb.shell('echo', [`'{}' > ${remoteFile}`]);
  } finally {
    await _appiumSupport.fs.rimraf(stringsTmpDir);
  }

  return {};
};

helpers.unlockWithUIAutomation = async function unlockWithUIAutomation(driver, adb, unlockCapabilities) {
  let unlockType = unlockCapabilities.unlockType;

  if (!_unlockHelpers.default.isValidUnlockType(unlockType)) {
    throw new Error(`Invalid unlock type ${unlockType}`);
  }

  let unlockKey = unlockCapabilities.unlockKey;

  if (!_unlockHelpers.default.isValidKey(unlockType, unlockKey)) {
    throw new Error(`Missing unlockKey ${unlockKey} capability for unlockType ${unlockType}`);
  }

  const unlockMethod = {
    [_unlockHelpers.PIN_UNLOCK]: _unlockHelpers.default.pinUnlock,
    [_unlockHelpers.PASSWORD_UNLOCK]: _unlockHelpers.default.passwordUnlock,
    [_unlockHelpers.PATTERN_UNLOCK]: _unlockHelpers.default.patternUnlock,
    [_unlockHelpers.FINGERPRINT_UNLOCK]: _unlockHelpers.default.fingerprintUnlock
  }[unlockType];
  await unlockMethod(adb, driver, unlockCapabilities);
};

helpers.unlockWithHelperApp = async function unlockWithHelperApp(adb) {
  _logger.default.info('Unlocking screen');

  let firstRun = true;
  await (0, _asyncbox.retry)(3, async function launchHelper() {
    if (firstRun) {
      firstRun = false;
    } else {
      try {
        if (!(await adb.isScreenLocked())) {
          return;
        }
      } catch (e) {
        _logger.default.warn(`Error in isScreenLocked: ${e.message}`);

        _logger.default.warn('"adb shell dumpsys window" command has timed out.');

        _logger.default.warn('The reason of this timeout is the delayed adb response. Resetting adb server can improve it.');
      }
    }

    _logger.default.info(`Launching ${SETTINGS_HELPER_UNLOCK_ACTIVITY}`);

    await adb.shell(['am', 'start', '-n', `${SETTINGS_HELPER_PKG_ID}/${SETTINGS_HELPER_UNLOCK_ACTIVITY}`, '-c', 'android.intent.category.LAUNCHER', '-a', 'android.intent.action.MAIN', '-f', '0x10200000']);
    await _bluebird.default.delay(1000);
  });
};

helpers.unlock = async function unlock(driver, adb, capabilities) {
  if (!(await adb.isScreenLocked())) {
    _logger.default.info('Screen already unlocked, doing nothing');

    return;
  }

  _logger.default.debug('Screen is locked, trying to unlock');

  if (_lodash.default.isUndefined(capabilities.unlockType)) {
    _logger.default.warn('Using app unlock, this is going to be deprecated!');

    await helpers.unlockWithHelperApp(adb);
  } else {
    await helpers.unlockWithUIAutomation(driver, adb, {
      unlockType: capabilities.unlockType,
      unlockKey: capabilities.unlockKey
    });
    await helpers.verifyUnlock(adb, capabilities.unlockSuccessTimeout);
  }
};

helpers.verifyUnlock = async function verifyUnlock(adb, unlockSuccessTimeout) {
  let successTimeout = unlockSuccessTimeout || 2000;
  await (0, _asyncbox.retryInterval)(successTimeout / 1000, successTimeout, async () => {
    if (await adb.isScreenLocked()) {
      throw new Error('Screen did not unlock successfully, retrying');
    }

    _logger.default.debug('Screen unlocked successfully');
  });
};

helpers.initDevice = async function initDevice(adb, opts) {
  if (opts.skipDeviceInitialization) {
    _logger.default.info(`'skipDeviceInitialization' is set. Skipping device initialization.`);
  } else {
    await adb.waitForDevice();
    const shouldThrowError = opts.language || opts.locale || opts.localeScript || opts.unicodeKeyboard || opts.disableWindowAnimation || !opts.skipUnlock;
    await helpers.pushSettingsApp(adb, shouldThrowError);
  }

  if (!opts.avd) {
    await helpers.setMockLocationApp(adb, SETTINGS_HELPER_PKG_ID);
  }

  if (opts.language || opts.locale) {
    await helpers.ensureDeviceLocale(adb, opts.language, opts.locale, opts.localeScript);
  }

  if (opts.skipLogcatCapture) {
    _logger.default.info(`'skipLogcatCapture' is set. Skipping starting logcat capture.`);
  } else {
    await adb.startLogcat();
  }

  if (opts.unicodeKeyboard) {
    return await helpers.initUnicodeKeyboard(adb);
  }
};

helpers.removeNullProperties = function removeNullProperties(obj) {
  for (let key of _lodash.default.keys(obj)) {
    if (_lodash.default.isNull(obj[key]) || _lodash.default.isUndefined(obj[key])) {
      delete obj[key];
    }
  }
};

helpers.truncateDecimals = function truncateDecimals(number, digits) {
  let multiplier = Math.pow(10, digits),
      adjustedNum = number * multiplier,
      truncatedNum = Math[adjustedNum < 0 ? 'ceil' : 'floor'](adjustedNum);
  return truncatedNum / multiplier;
};

helpers.isChromeBrowser = function isChromeBrowser(browser) {
  return _lodash.default.includes(Object.keys(CHROME_BROWSER_PACKAGE_ACTIVITY), (browser || '').toLowerCase());
};

helpers.getChromePkg = function getChromePkg(browser) {
  return CHROME_BROWSER_PACKAGE_ACTIVITY[browser.toLowerCase()] || CHROME_BROWSER_PACKAGE_ACTIVITY.default;
};

helpers.removeAllSessionWebSocketHandlers = async function removeAllSessionWebSocketHandlers(server, sessionId) {
  if (!server || !_lodash.default.isFunction(server.getWebSocketHandlers)) {
    return;
  }

  const activeHandlers = await server.getWebSocketHandlers(sessionId);

  for (const pathname of _lodash.default.keys(activeHandlers)) {
    await server.removeWebSocketHandler(pathname);
  }
};

helpers.parseArray = function parseArray(cap) {
  let parsedCaps;

  try {
    parsedCaps = JSON.parse(cap);
  } catch (ign) {}

  if (_lodash.default.isArray(parsedCaps)) {
    return parsedCaps;
  } else if (_lodash.default.isString(cap)) {
    return [cap];
  }

  throw new Error(`must provide a string or JSON Array; received ${cap}`);
};

helpers.validateDesiredCaps = function validateDesiredCaps(caps) {
  if (caps.browserName) {
    if (caps.app) {
      _logger.default.warn(`The desired capabilities should generally not include both an 'app' and a 'browserName'`);
    }

    if (caps.appPackage) {
      _logger.default.errorAndThrow(`The desired should not include both of an 'appPackage' and a 'browserName'`);
    }
  }

  if (caps.uninstallOtherPackages) {
    try {
      this.parseArray(caps.uninstallOtherPackages);
    } catch (e) {
      _logger.default.errorAndThrow(`Could not parse "uninstallOtherPackages" capability: ${e.message}`);
    }
  }

  return true;
};

helpers.adjustBrowserSessionCaps = function adjustBrowserSessionCaps(caps = {}) {
  const {
    browserName
  } = caps;

  _logger.default.info(`The current session is considered browser-based`);

  _logger.default.info(`Supported browser names: ${JSON.stringify(_lodash.default.keys(CHROME_BROWSER_PACKAGE_ACTIVITY))}`);

  if (caps.appPackage || caps.appActivity) {
    _logger.default.info(`Not overriding appPackage/appActivity capability values for '${browserName}' ` + 'because some of them have been already provided');

    return caps;
  }

  const {
    pkg,
    activity
  } = this.getChromePkg(browserName);
  caps.appPackage = pkg;
  caps.appActivity = activity;

  _logger.default.info(`appPackage/appActivity capabilities have been automatically set to ${pkg}/${activity} ` + `for '${browserName}'`);

  _logger.default.info(`Consider changing the browserName to the one from the list of supported browser names ` + `or provide custom appPackage/appActivity capability values if the automatically assigned ones do ` + `not make sense`);

  return caps;
};

helpers.isEmulator = function isEmulator(adb, opts) {
  const possibleNames = [opts.udid, adb === null || adb === void 0 ? void 0 : adb.curDeviceId];
  return !!opts.avd || possibleNames.some(x => EMULATOR_PATTERN.test(x));
};

helpers.bootstrap = _bootstrap.default;
helpers.unlocker = _unlockHelpers.default;
var _default = helpers;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9hbmRyb2lkLWhlbHBlcnMuanMiXSwibmFtZXMiOlsiUEFDS0FHRV9JTlNUQUxMX1RJTUVPVVQiLCJDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZIiwiY2hyb21lIiwicGtnIiwiYWN0aXZpdHkiLCJjaHJvbWl1bSIsImNocm9tZWJldGEiLCJicm93c2VyIiwiZGVmYXVsdCIsIlNFVFRJTkdTX0hFTFBFUl9QS0dfSUQiLCJTRVRUSU5HU19IRUxQRVJfVU5MT0NLX0FDVElWSVRZIiwiRU1VTEFUT1JfUEFUVEVSTiIsImhlbHBlcnMiLCJjcmVhdGVCYXNlQURCIiwib3B0cyIsImFkYlBvcnQiLCJzdXBwcmVzc0tpbGxTZXJ2ZXIiLCJyZW1vdGVBZGJIb3N0IiwiY2xlYXJEZXZpY2VMb2dzT25TdGFydCIsImFkYkV4ZWNUaW1lb3V0IiwidXNlS2V5c3RvcmUiLCJrZXlzdG9yZVBhdGgiLCJrZXlzdG9yZVBhc3N3b3JkIiwia2V5QWxpYXMiLCJrZXlQYXNzd29yZCIsInJlbW90ZUFwcHNDYWNoZUxpbWl0IiwiYnVpbGRUb29sc1ZlcnNpb24iLCJhbGxvd09mZmxpbmVEZXZpY2VzIiwiQURCIiwiY3JlYXRlQURCIiwicHJlcGFyZUVtdWxhdG9yIiwiYWRiIiwiYXZkIiwiYXZkQXJncyIsImxhbmd1YWdlIiwibG9jYWxlIiwiYXZkTGF1bmNoVGltZW91dCIsImF2ZFJlYWR5VGltZW91dCIsIkVycm9yIiwiYXZkTmFtZSIsInJlcGxhY2UiLCJydW5uaW5nQVZEIiwiZ2V0UnVubmluZ0FWRCIsInRvTG93ZXJDYXNlIiwiaW5kZXhPZiIsImxvZ2dlciIsImRlYnVnIiwia2lsbEVtdWxhdG9yIiwicHJlcGFyZUFWREFyZ3MiLCJsYXVuY2hBVkQiLCJhcmdzIiwiXyIsImlzVW5kZWZpbmVkIiwibmV0d29ya1NwZWVkIiwiZW5zdXJlTmV0d29ya1NwZWVkIiwicHVzaCIsImlzSGVhZGxlc3MiLCJqb2luIiwidmFsdWVzIiwiTkVUV09SS19TUEVFRCIsIndhcm4iLCJGVUxMIiwiZW5zdXJlRGV2aWNlTG9jYWxlIiwiY291bnRyeSIsInNjcmlwdCIsImlzU3RyaW5nIiwic2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IiwiZW5zdXJlQ3VycmVudExvY2FsZSIsIm1lc3NhZ2UiLCJnZXREZXZpY2VJbmZvRnJvbUNhcHMiLCJ1ZGlkIiwiZW1Qb3J0IiwiY3VyRGV2aWNlSWQiLCJlbXVsYXRvclBvcnQiLCJpbmZvIiwiZGV2aWNlcyIsImdldERldmljZXNXaXRoUmV0cnkiLCJpbmNsdWRlcyIsIm1hcCIsImVycm9yQW5kVGhyb3ciLCJnZXRQb3J0RnJvbUVtdWxhdG9yU3RyaW5nIiwicGxhdGZvcm1WZXJzaW9uIiwidHJpbSIsInNlbXZlciIsImNvZXJjZSIsImF2YWlsRGV2aWNlcyIsInBhcnRpYWxNYXRjaENhbmRpZGF0ZSIsImRldmljZSIsInNldERldmljZUlkIiwicmF3RGV2aWNlT1MiLCJnZXRQbGF0Zm9ybVZlcnNpb24iLCJkZXZpY2VPUyIsImJvdGhWZXJzaW9uc0NhbkJlQ29lcmNlZCIsInZhbGlkIiwiYm90aFZlcnNpb25zQXJlU3RyaW5ncyIsInZlcnNpb24iLCJ0b0xvd2VyIiwibWFqb3IiLCJtaW5vciIsImd0Iiwia2V5cyIsInNldEVtdWxhdG9yUG9ydCIsInZhbGlkYXRlUGFja2FnZUFjdGl2aXR5TmFtZXMiLCJrZXkiLCJuYW1lIiwibWF0Y2giLCJleGVjIiwiaW5kZXgiLCJzdWJzdHJpbmciLCJnZXRMYXVuY2hJbmZvIiwiYXBwIiwiYXBwUGFja2FnZSIsImFwcEFjdGl2aXR5IiwiYXBwV2FpdFBhY2thZ2UiLCJhcHBXYWl0QWN0aXZpdHkiLCJhcGtQYWNrYWdlIiwiYXBrQWN0aXZpdHkiLCJwYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QiLCJyZXNldEFwcCIsImZhc3RSZXNldCIsImZ1bGxSZXNldCIsImFuZHJvaWRJbnN0YWxsVGltZW91dCIsImF1dG9HcmFudFBlcm1pc3Npb25zIiwiYWxsb3dUZXN0UGFja2FnZXMiLCJpc0luc3RhbGxlZCIsImlzQXBwSW5zdGFsbGVkIiwiZm9yY2VTdG9wIiwiaWduIiwib3V0cHV0IiwiY2xlYXIiLCJncmFudEFsbFBlcm1pc3Npb25zIiwiZXJyb3IiLCJ1bmluc3RhbGxBcGsiLCJpbnN0YWxsIiwiZ3JhbnRQZXJtaXNzaW9ucyIsInRpbWVvdXQiLCJpbnN0YWxsQXBrIiwiZW5mb3JjZUFwcEluc3RhbGwiLCJhcHBTdGF0ZSIsIndhc1VuaW5zdGFsbGVkIiwiaW5zdGFsbE9yVXBncmFkZSIsImVuZm9yY2VDdXJyZW50QnVpbGQiLCJpc0luc3RhbGxlZE92ZXJFeGlzdGluZ0FwcCIsIkFQUF9JTlNUQUxMX1NUQVRFIiwiTk9UX0lOU1RBTExFRCIsImluc3RhbGxPdGhlckFwa3MiLCJvdGhlckFwcHMiLCJCIiwiYWxsIiwib3RoZXJBcHAiLCJ1bmluc3RhbGxPdGhlclBhY2thZ2VzIiwiYXBwUGFja2FnZXMiLCJmaWx0ZXJQYWNrYWdlcyIsImdldFRoaXJkUGFydHlQYWNrYWdlcyIsInBhY2thZ2VzU3RyaW5nIiwic2hlbGwiLCJhcHBQYWNrYWdlc0FycmF5Iiwic3BsaXQiLCJFT0wiLCJkaWZmZXJlbmNlIiwiZXJyIiwiaW5pdFVuaWNvZGVLZXlib2FyZCIsImRlZmF1bHRJTUUiLCJhcHBpdW1JTUUiLCJlbmFibGVJTUUiLCJzZXRJTUUiLCJzZXRNb2NrTG9jYXRpb25BcHAiLCJnZXRBcGlMZXZlbCIsImluc3RhbGxIZWxwZXJBcHAiLCJhcGtQYXRoIiwicGFja2FnZUlkIiwicmV0cnlJbnN0YWxsSGVscGVyQXBwIiwicHVzaFNldHRpbmdzQXBwIiwidGhyb3dFcnJvciIsInNldHRpbmdzQXBrUGF0aCIsInByb2Nlc3NFeGlzdHMiLCJwZXJtcyIsIngiLCJyZXF1aXJlUnVubmluZ1NldHRpbmdzQXBwIiwicHVzaFN0cmluZ3MiLCJyZW1vdGVEaXIiLCJzdHJpbmdzSnNvbiIsInJlbW90ZUZpbGUiLCJwYXRoIiwicG9zaXgiLCJyZXNvbHZlIiwicmltcmFmIiwicHVsbEFwayIsInRtcERpciIsImlzRW1wdHkiLCJmcyIsImV4aXN0cyIsInN0cmluZ3NUbXBEaXIiLCJhcGtTdHJpbmdzIiwibG9jYWxQYXRoIiwiZXh0cmFjdFN0cmluZ3NGcm9tQXBrIiwidW5sb2NrV2l0aFVJQXV0b21hdGlvbiIsImRyaXZlciIsInVubG9ja0NhcGFiaWxpdGllcyIsInVubG9ja1R5cGUiLCJ1bmxvY2tlciIsImlzVmFsaWRVbmxvY2tUeXBlIiwidW5sb2NrS2V5IiwiaXNWYWxpZEtleSIsInVubG9ja01ldGhvZCIsIlBJTl9VTkxPQ0siLCJwaW5VbmxvY2siLCJQQVNTV09SRF9VTkxPQ0siLCJwYXNzd29yZFVubG9jayIsIlBBVFRFUk5fVU5MT0NLIiwicGF0dGVyblVubG9jayIsIkZJTkdFUlBSSU5UX1VOTE9DSyIsImZpbmdlcnByaW50VW5sb2NrIiwidW5sb2NrV2l0aEhlbHBlckFwcCIsImZpcnN0UnVuIiwibGF1bmNoSGVscGVyIiwiaXNTY3JlZW5Mb2NrZWQiLCJlIiwiZGVsYXkiLCJ1bmxvY2siLCJjYXBhYmlsaXRpZXMiLCJ2ZXJpZnlVbmxvY2siLCJ1bmxvY2tTdWNjZXNzVGltZW91dCIsInN1Y2Nlc3NUaW1lb3V0IiwiaW5pdERldmljZSIsInNraXBEZXZpY2VJbml0aWFsaXphdGlvbiIsIndhaXRGb3JEZXZpY2UiLCJzaG91bGRUaHJvd0Vycm9yIiwibG9jYWxlU2NyaXB0IiwidW5pY29kZUtleWJvYXJkIiwiZGlzYWJsZVdpbmRvd0FuaW1hdGlvbiIsInNraXBVbmxvY2siLCJza2lwTG9nY2F0Q2FwdHVyZSIsInN0YXJ0TG9nY2F0IiwicmVtb3ZlTnVsbFByb3BlcnRpZXMiLCJvYmoiLCJpc051bGwiLCJ0cnVuY2F0ZURlY2ltYWxzIiwibnVtYmVyIiwiZGlnaXRzIiwibXVsdGlwbGllciIsIk1hdGgiLCJwb3ciLCJhZGp1c3RlZE51bSIsInRydW5jYXRlZE51bSIsImlzQ2hyb21lQnJvd3NlciIsIk9iamVjdCIsImdldENocm9tZVBrZyIsInJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyIsInNlcnZlciIsInNlc3Npb25JZCIsImlzRnVuY3Rpb24iLCJnZXRXZWJTb2NrZXRIYW5kbGVycyIsImFjdGl2ZUhhbmRsZXJzIiwicGF0aG5hbWUiLCJyZW1vdmVXZWJTb2NrZXRIYW5kbGVyIiwicGFyc2VBcnJheSIsImNhcCIsInBhcnNlZENhcHMiLCJKU09OIiwicGFyc2UiLCJpc0FycmF5IiwidmFsaWRhdGVEZXNpcmVkQ2FwcyIsImNhcHMiLCJicm93c2VyTmFtZSIsImFkanVzdEJyb3dzZXJTZXNzaW9uQ2FwcyIsInN0cmluZ2lmeSIsImlzRW11bGF0b3IiLCJwb3NzaWJsZU5hbWVzIiwic29tZSIsInRlc3QiLCJib290c3RyYXAiLCJCb290c3RyYXAiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFDQTs7QUFFQSxNQUFNQSx1QkFBdUIsR0FBRyxLQUFoQztBQUVBLE1BQU1DLCtCQUErQixHQUFHO0FBQ3RDQyxFQUFBQSxNQUFNLEVBQUU7QUFDTkMsSUFBQUEsR0FBRyxFQUFFLG9CQURDO0FBRU5DLElBQUFBLFFBQVEsRUFBRTtBQUZKLEdBRDhCO0FBS3RDQyxFQUFBQSxRQUFRLEVBQUU7QUFDUkYsSUFBQUEsR0FBRyxFQUFFLDJCQURHO0FBRVJDLElBQUFBLFFBQVEsRUFBRTtBQUZGLEdBTDRCO0FBU3RDRSxFQUFBQSxVQUFVLEVBQUU7QUFDVkgsSUFBQUEsR0FBRyxFQUFFLGlCQURLO0FBRVZDLElBQUFBLFFBQVEsRUFBRTtBQUZBLEdBVDBCO0FBYXRDRyxFQUFBQSxPQUFPLEVBQUU7QUFDUEosSUFBQUEsR0FBRyxFQUFFLHFCQURFO0FBRVBDLElBQUFBLFFBQVEsRUFBRTtBQUZILEdBYjZCO0FBaUJ0QyxzQkFBb0I7QUFDbEJELElBQUFBLEdBQUcsRUFBRSxxQkFEYTtBQUVsQkMsSUFBQUEsUUFBUSxFQUFFO0FBRlEsR0FqQmtCO0FBcUJ0QyxzQkFB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QWEsQ0FBQ0MsSUFBZCxDQUFvQjVGLENBQUQsSUFBT3RLLGdCQUFnQixDQUFDbVEsSUFBakIsQ0FBc0I3RixDQUF0QixDQUExQixDQUFyQjtBQUNELENBSEQ7O0FBS0FySyxPQUFPLENBQUNtUSxTQUFSLEdBQW9CQyxrQkFBcEI7QUFDQXBRLE9BQU8sQ0FBQzRMLFFBQVIsR0FBbUJBLHNCQUFuQjtlQUdlNUwsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IHJldHJ5LCByZXRyeUludGVydmFsIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IGxvZ2dlciBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBmcyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCB7IHBhdGggYXMgc2V0dGluZ3NBcGtQYXRoIH0gZnJvbSAnaW8uYXBwaXVtLnNldHRpbmdzJztcbmltcG9ydCBCb290c3RyYXAgZnJvbSAnLi9ib290c3RyYXAnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IEFEQiBmcm9tICdhcHBpdW0tYWRiJztcbmltcG9ydCB7XG4gIGRlZmF1bHQgYXMgdW5sb2NrZXIsIFBJTl9VTkxPQ0ssIFBBU1NXT1JEX1VOTE9DSyxcbiAgUEFUVEVSTl9VTkxPQ0ssIEZJTkdFUlBSSU5UX1VOTE9DSyB9IGZyb20gJy4vdW5sb2NrLWhlbHBlcnMnO1xuaW1wb3J0IHsgRU9MIH0gZnJvbSAnb3MnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuXG5jb25zdCBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCA9IDkwMDAwOyAvLyBtaWxsaXNlY29uZHNcbi8vIGh0dHBzOi8vY3MuY2hyb21pdW0ub3JnL2Nocm9taXVtL3NyYy9jaHJvbWUvYnJvd3Nlci9kZXZ0b29scy9kZXZpY2UvYW5kcm9pZF9kZXZpY2VfaW5mb19xdWVyeS5jY1xuY29uc3QgQ0hST01FX0JST1dTRVJfUEFDS0FHRV9BQ1RJVklUWSA9IHtcbiAgY2hyb21lOiB7XG4gICAgcGtnOiAnY29tLmFuZHJvaWQuY2hyb21lJyxcbiAgICBhY3Rpdml0eTogJ2NvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluJyxcbiAgfSxcbiAgY2hyb21pdW06IHtcbiAgICBwa2c6ICdvcmcuY2hyb21pdW0uY2hyb21lLnNoZWxsJyxcbiAgICBhY3Rpdml0eTogJy5DaHJvbWVTaGVsbEFjdGl2aXR5JyxcbiAgfSxcbiAgY2hyb21lYmV0YToge1xuICAgIHBrZzogJ2NvbS5jaHJvbWUuYmV0YScsXG4gICAgYWN0aXZpdHk6ICdjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbicsXG4gIH0sXG4gIGJyb3dzZXI6IHtcbiAgICBwa2c6ICdjb20uYW5kcm9pZC5icm93c2VyJyxcbiAgICBhY3Rpdml0eTogJ2NvbS5hbmRyb2lkLmJyb3dzZXIuQnJvd3NlckFjdGl2aXR5JyxcbiAgfSxcbiAgJ2Nocm9taXVtLWJyb3dzZXInOiB7XG4gICAgcGtnOiAnb3JnLmNocm9taXVtLmNocm9tZScsXG4gICAgYWN0aXZpdHk6ICdjb20uZ29vZ2xlLmFuZHJvaWQuYXBwcy5jaHJvbWUuTWFpbicsXG4gIH0sXG4gICdjaHJvbWl1bS13ZWJ2aWV3Jzoge1xuICAgIHBrZzogJ29yZy5jaHJvbWl1bS53ZWJ2aWV3X3NoZWxsJyxcbiAgICBhY3Rpdml0eTogJ29yZy5jaHJvbWl1bS53ZWJ2aWV3X3NoZWxsLldlYlZpZXdCcm93c2VyQWN0aXZpdHknLFxuICB9LFxuICBkZWZhdWx0OiB7XG4gICAgcGtnOiAnY29tLmFuZHJvaWQuY2hyb21lJyxcbiAgICBhY3Rpdml0eTogJ2NvbS5nb29nbGUuYW5kcm9pZC5hcHBzLmNocm9tZS5NYWluJyxcbiAgfSxcbn07XG5jb25zdCBTRVRUSU5HU19IRUxQRVJfUEtHX0lEID0gJ2lvLmFwcGl1bS5zZXR0aW5ncyc7XG5jb25zdCBTRVRUSU5HU19IRUxQRVJfVU5MT0NLX0FDVElWSVRZID0gJy5VbmxvY2snO1xuY29uc3QgRU1VTEFUT1JfUEFUVEVSTiA9IC9cXGJlbXVsYXRvclxcYi9pO1xuXG5sZXQgaGVscGVycyA9IHt9O1xuXG5oZWxwZXJzLmNyZWF0ZUJhc2VBREIgPSBhc3luYyBmdW5jdGlvbiBjcmVhdGVCYXNlQURCIChvcHRzID0ge30pIHtcbiAgLy8gZmlsdGVyIG91dCBhbnkgdW53YW50ZWQgb3B0aW9ucyBzZW50IGluXG4gIC8vIHRoaXMgbGlzdCBzaG91bGQgYmUgdXBkYXRlZCBhcyBBREIgdGFrZXMgbW9yZSBhcmd1bWVudHNcbiAgY29uc3Qge1xuICAgIGFkYlBvcnQsXG4gICAgc3VwcHJlc3NLaWxsU2VydmVyLFxuICAgIHJlbW90ZUFkYkhvc3QsXG4gICAgY2xlYXJEZXZpY2VMb2dzT25TdGFydCxcbiAgICBhZGJFeGVjVGltZW91dCxcbiAgICB1c2VLZXlzdG9yZSxcbiAgICBrZXlzdG9yZVBhdGgsXG4gICAga2V5c3RvcmVQYXNzd29yZCxcbiAgICBrZXlBbGlhcyxcbiAgICBrZXlQYXNzd29yZCxcbiAgICByZW1vdGVBcHBzQ2FjaGVMaW1pdCxcbiAgICBidWlsZFRvb2xzVmVyc2lvbixcbiAgICBhbGxvd09mZmxpbmVEZXZpY2VzLFxuICB9ID0gb3B0cztcbiAgcmV0dXJuIGF3YWl0IEFEQi5jcmVhdGVBREIoe1xuICAgIGFkYlBvcnQsXG4gICAgc3VwcHJlc3NLaWxsU2VydmVyLFxuICAgIHJlbW90ZUFkYkhvc3QsXG4gICAgY2xlYXJEZXZpY2VMb2dzT25TdGFydCxcbiAgICBhZGJFeGVjVGltZW91dCxcbiAgICB1c2VLZXlzdG9yZSxcbiAgICBrZXlzdG9yZVBhdGgsXG4gICAga2V5c3RvcmVQYXNzd29yZCxcbiAgICBrZXlBbGlhcyxcbiAgICBrZXlQYXNzd29yZCxcbiAgICByZW1vdGVBcHBzQ2FjaGVMaW1pdCxcbiAgICBidWlsZFRvb2xzVmVyc2lvbixcbiAgICBhbGxvd09mZmxpbmVEZXZpY2VzLFxuICB9KTtcbn07XG5cbmhlbHBlcnMucHJlcGFyZUVtdWxhdG9yID0gYXN5bmMgZnVuY3Rpb24gcHJlcGFyZUVtdWxhdG9yIChhZGIsIG9wdHMpIHtcbiAgbGV0IHtcbiAgICBhdmQsXG4gICAgYXZkQXJncyxcbiAgICBsYW5ndWFnZSxcbiAgICBsb2NhbGUsXG4gICAgYXZkTGF1bmNoVGltZW91dCxcbiAgICBhdmRSZWFkeVRpbWVvdXQsXG4gIH0gPSBvcHRzO1xuICBpZiAoIWF2ZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGxhdW5jaCBBVkQgd2l0aG91dCBBVkQgbmFtZScpO1xuICB9XG4gIGxldCBhdmROYW1lID0gYXZkLnJlcGxhY2UoJ0AnLCAnJyk7XG4gIGxldCBydW5uaW5nQVZEID0gYXdhaXQgYWRiLmdldFJ1bm5pbmdBVkQoYXZkTmFtZSk7XG4gIGlmIChydW5uaW5nQVZEICE9PSBudWxsKSB7XG4gICAgaWYgKGF2ZEFyZ3MgJiYgYXZkQXJncy50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJy13aXBlLWRhdGEnKSA+IC0xKSB7XG4gICAgICBsb2dnZXIuZGVidWcoYEtpbGxpbmcgJyR7YXZkTmFtZX0nIGJlY2F1c2UgaXQgbmVlZHMgdG8gYmUgd2lwZWQgYXQgc3RhcnQuYCk7XG4gICAgICBhd2FpdCBhZGIua2lsbEVtdWxhdG9yKGF2ZE5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ05vdCBsYXVuY2hpbmcgQVZEIGJlY2F1c2UgaXQgaXMgYWxyZWFkeSBydW5uaW5nLicpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBhdmRBcmdzID0gdGhpcy5wcmVwYXJlQVZEQXJncyhvcHRzLCBhZGIsIGF2ZEFyZ3MpO1xuICBhd2FpdCBhZGIubGF1bmNoQVZEKGF2ZCwgYXZkQXJncywgbGFuZ3VhZ2UsIGxvY2FsZSwgYXZkTGF1bmNoVGltZW91dCxcbiAgICAgICAgICAgICAgICAgICAgICBhdmRSZWFkeVRpbWVvdXQpO1xufTtcblxuaGVscGVycy5wcmVwYXJlQVZEQXJncyA9IGZ1bmN0aW9uIHByZXBhcmVBVkRBcmdzIChvcHRzLCBhZGIsIGF2ZEFyZ3MpIHtcbiAgbGV0IGFyZ3MgPSBhdmRBcmdzID8gW2F2ZEFyZ3NdIDogW107XG4gIGlmICghXy5pc1VuZGVmaW5lZChvcHRzLm5ldHdvcmtTcGVlZCkpIHtcbiAgICBsZXQgbmV0d29ya1NwZWVkID0gdGhpcy5lbnN1cmVOZXR3b3JrU3BlZWQoYWRiLCBvcHRzLm5ldHdvcmtTcGVlZCk7XG4gICAgYXJncy5wdXNoKCctbmV0c3BlZWQnLCBuZXR3b3JrU3BlZWQpO1xuICB9XG4gIGlmIChvcHRzLmlzSGVhZGxlc3MpIHtcbiAgICBhcmdzLnB1c2goJy1uby13aW5kb3cnKTtcbiAgfVxuICByZXR1cm4gYXJncy5qb2luKCcgJyk7XG59O1xuXG5oZWxwZXJzLmVuc3VyZU5ldHdvcmtTcGVlZCA9IGZ1bmN0aW9uIGVuc3VyZU5ldHdvcmtTcGVlZCAoYWRiLCBuZXR3b3JrU3BlZWQpIHtcbiAgaWYgKF8udmFsdWVzKGFkYi5ORVRXT1JLX1NQRUVEKS5pbmRleE9mKG5ldHdvcmtTcGVlZCkgIT09IC0xKSB7XG4gICAgcmV0dXJuIG5ldHdvcmtTcGVlZDtcbiAgfVxuICBsb2dnZXIud2FybihgV3JvbmcgbmV0d29yayBzcGVlZCBwYXJhbSAke25ldHdvcmtTcGVlZH0sIHVzaW5nIGRlZmF1bHQ6IGZ1bGwuIFN1cHBvcnRlZCB2YWx1ZXM6ICR7Xy52YWx1ZXMoYWRiLk5FVFdPUktfU1BFRUQpfWApO1xuICByZXR1cm4gYWRiLk5FVFdPUktfU1BFRUQuRlVMTDtcbn07XG5cbi8qKlxuICogU2V0IGFuZCBlbnN1cmUgdGhlIGxvY2FsZSBuYW1lIG9mIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gYWRiIC0gVGhlIGFkYiBtb2R1bGUgaW5zdGFuY2UuXG4gKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2UgLSBMYW5ndWFnZS4gVGhlIGxhbmd1YWdlIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gbG93ZXIgY2FzZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogW2EtekEtWl17Miw4fS4gZS5nLiBlbiwgamEgOiBodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9yZWZlcmVuY2UvamF2YS91dGlsL0xvY2FsZS5odG1sXG4gKiBAcGFyYW0ge3N0cmluZ30gY291bnRyeSAtIENvdW50cnkuIFRoZSBjb3VudHJ5IChyZWdpb24pIGZpZWxkIGlzIGNhc2UgaW5zZW5zaXRpdmUsIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gdXBwZXIgY2FzZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogW2EtekEtWl17Mn0gfCBbMC05XXszfS4gZS5nLiBVUywgSlAgOiBodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9yZWZlcmVuY2UvamF2YS91dGlsL0xvY2FsZS5odG1sXG4gKiBAcGFyYW0gez9zdHJpbmd9IHNjcmlwdCAtIFNjcmlwdC4gVGhlIHNjcmlwdCBmaWVsZCBpcyBjYXNlIGluc2Vuc2l0aXZlIGJ1dCBMb2NhbGUgYWx3YXlzIGNhbm9uaWNhbGl6ZXMgdG8gdGl0bGUgY2FzZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogW2EtekEtWl17NH0uIGUuZy4gSGFucyBpbiB6aC1IYW5zLUNOIDogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2phdmEvdXRpbC9Mb2NhbGUuaHRtbFxuICogQHRocm93cyB7RXJyb3J9IElmIGl0IGZhaWxlZCB0byBzZXQgbG9jYWxlIHByb3Blcmx5XG4gKi9cbmhlbHBlcnMuZW5zdXJlRGV2aWNlTG9jYWxlID0gYXN5bmMgZnVuY3Rpb24gZW5zdXJlRGV2aWNlTG9jYWxlIChhZGIsIGxhbmd1YWdlLCBjb3VudHJ5LCBzY3JpcHQgPSBudWxsKSB7XG4gIGlmICghXy5pc1N0cmluZyhsYW5ndWFnZSkgJiYgIV8uaXNTdHJpbmcoY291bnRyeSkpIHtcbiAgICBsb2dnZXIud2Fybihgc2V0RGV2aWNlTGFuZ3VhZ2VDb3VudHJ5IHJlcXVpcmVzIGxhbmd1YWdlIG9yIGNvdW50cnkuYCk7XG4gICAgbG9nZ2VyLndhcm4oYEdvdCBsYW5ndWFnZTogJyR7bGFuZ3VhZ2V9JyBhbmQgY291bnRyeTogJyR7Y291bnRyeX0nYCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgYXdhaXQgYWRiLnNldERldmljZUxhbmd1YWdlQ291bnRyeShsYW5ndWFnZSwgY291bnRyeSwgc2NyaXB0KTtcblxuICBpZiAoIWF3YWl0IGFkYi5lbnN1cmVDdXJyZW50TG9jYWxlKGxhbmd1YWdlLCBjb3VudHJ5LCBzY3JpcHQpKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IHNjcmlwdCA/IGBsYW5ndWFnZTogJHtsYW5ndWFnZX0sIGNvdW50cnk6ICR7Y291bnRyeX0gYW5kIHNjcmlwdDogJHtzY3JpcHR9YCA6IGBsYW5ndWFnZTogJHtsYW5ndWFnZX0gYW5kIGNvdW50cnk6ICR7Y291bnRyeX1gO1xuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHNldCAke21lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuZ2V0RGV2aWNlSW5mb0Zyb21DYXBzID0gYXN5bmMgZnVuY3Rpb24gZ2V0RGV2aWNlSW5mb0Zyb21DYXBzIChvcHRzID0ge30pIHtcbiAgLy8gd2UgY2FuIGNyZWF0ZSBhIHRocm93YXdheSBBREIgaW5zdGFuY2UgaGVyZSwgc28gdGhlcmUgaXMgbm8gZGVwZW5kZW5jeVxuICAvLyBvbiBpbnN0YW50aWF0aW5nIG9uIGVhcmxpZXIgKGF0IHRoaXMgcG9pbnQsIHdlIGhhdmUgbm8gdWRpZClcbiAgLy8gd2UgY2FuIG9ubHkgdXNlIHRoaXMgQURCIG9iamVjdCBmb3IgY29tbWFuZHMgdGhhdCB3b3VsZCBub3QgYmUgY29uZnVzZWRcbiAgLy8gaWYgbXVsdGlwbGUgZGV2aWNlcyBhcmUgY29ubmVjdGVkXG4gIGNvbnN0IGFkYiA9IGF3YWl0IGhlbHBlcnMuY3JlYXRlQmFzZUFEQihvcHRzKTtcbiAgbGV0IHVkaWQgPSBvcHRzLnVkaWQ7XG4gIGxldCBlbVBvcnQgPSBudWxsO1xuXG4gIC8vIGEgc3BlY2lmaWMgYXZkIG5hbWUgd2FzIGdpdmVuLiB0cnkgdG8gaW5pdGlhbGl6ZSB3aXRoIHRoYXRcbiAgaWYgKG9wdHMuYXZkKSB7XG4gICAgYXdhaXQgaGVscGVycy5wcmVwYXJlRW11bGF0b3IoYWRiLCBvcHRzKTtcbiAgICB1ZGlkID0gYWRiLmN1ckRldmljZUlkO1xuICAgIGVtUG9ydCA9IGFkYi5lbXVsYXRvclBvcnQ7XG4gIH0gZWxzZSB7XG4gICAgLy8gbm8gYXZkIGdpdmVuLiBsZXRzIHRyeSB3aGF0ZXZlcidzIHBsdWdnZWQgaW4gZGV2aWNlcy9lbXVsYXRvcnNcbiAgICBsb2dnZXIuaW5mbygnUmV0cmlldmluZyBkZXZpY2UgbGlzdCcpO1xuICAgIGxldCBkZXZpY2VzID0gYXdhaXQgYWRiLmdldERldmljZXNXaXRoUmV0cnkoKTtcblxuICAgIC8vIHVkaWQgd2FzIGdpdmVuLCBsZXRzIHRyeSB0byBpbml0IHdpdGggdGhhdCBkZXZpY2VcbiAgICBpZiAodWRpZCkge1xuICAgICAgaWYgKCFfLmluY2x1ZGVzKF8ubWFwKGRldmljZXMsICd1ZGlkJyksIHVkaWQpKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KGBEZXZpY2UgJHt1ZGlkfSB3YXMgbm90IGluIHRoZSBsaXN0IG9mIGNvbm5lY3RlZCBkZXZpY2VzYCk7XG4gICAgICB9XG4gICAgICBlbVBvcnQgPSBhZGIuZ2V0UG9ydEZyb21FbXVsYXRvclN0cmluZyh1ZGlkKTtcbiAgICB9IGVsc2UgaWYgKG9wdHMucGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgICBvcHRzLnBsYXRmb3JtVmVyc2lvbiA9IGAke29wdHMucGxhdGZvcm1WZXJzaW9ufWAudHJpbSgpO1xuXG4gICAgICAvLyBhIHBsYXRmb3JtIHZlcnNpb24gd2FzIGdpdmVuLiBsZXRzIHRyeSB0byBmaW5kIGEgZGV2aWNlIHdpdGggdGhlIHNhbWUgb3NcbiAgICAgIGNvbnN0IHBsYXRmb3JtVmVyc2lvbiA9IHNlbXZlci5jb2VyY2Uob3B0cy5wbGF0Zm9ybVZlcnNpb24pIHx8IG9wdHMucGxhdGZvcm1WZXJzaW9uO1xuICAgICAgbG9nZ2VyLmluZm8oYExvb2tpbmcgZm9yIGEgZGV2aWNlIHdpdGggQW5kcm9pZCAnJHtwbGF0Zm9ybVZlcnNpb259J2ApO1xuXG4gICAgICAvLyBpbiBjYXNlIHdlIGZhaWwgdG8gZmluZCBzb21ldGhpbmcsIGdpdmUgdGhlIHVzZXIgYSB1c2VmdWwgbG9nIHRoYXQgaGFzXG4gICAgICAvLyB0aGUgZGV2aWNlIHVkaWRzIGFuZCBvcyB2ZXJzaW9ucyBzbyB0aGV5IGtub3cgd2hhdCdzIGF2YWlsYWJsZVxuICAgICAgY29uc3QgYXZhaWxEZXZpY2VzID0gW107XG4gICAgICBsZXQgcGFydGlhbE1hdGNoQ2FuZGlkYXRlID0gbnVsbDtcbiAgICAgIC8vIGZpcnN0IHRyeSBzdGFydGVkIGRldmljZXMvZW11bGF0b3JzXG4gICAgICBmb3IgKGNvbnN0IGRldmljZSBvZiBkZXZpY2VzKSB7XG4gICAgICAgIC8vIGRpcmVjdCBhZGIgY2FsbHMgdG8gdGhlIHNwZWNpZmljIGRldmljZVxuICAgICAgICBhd2FpdCBhZGIuc2V0RGV2aWNlSWQoZGV2aWNlLnVkaWQpO1xuICAgICAgICBjb25zdCByYXdEZXZpY2VPUyA9IGF3YWl0IGFkYi5nZXRQbGF0Zm9ybVZlcnNpb24oKTtcbiAgICAgICAgLy8gVGhlIGRldmljZSBPUyBjb3VsZCBlaXRoZXIgYmUgYSBudW1iZXIsIGxpa2UgYDYuMGBcbiAgICAgICAgLy8gb3IgYW4gYWJicmV2aWF0aW9uLCBsaWtlIGBSYFxuICAgICAgICBhdmFpbERldmljZXMucHVzaChgJHtkZXZpY2UudWRpZH0gKCR7cmF3RGV2aWNlT1N9KWApO1xuICAgICAgICBjb25zdCBkZXZpY2VPUyA9IHNlbXZlci5jb2VyY2UocmF3RGV2aWNlT1MpIHx8IHJhd0RldmljZU9TO1xuICAgICAgICBpZiAoIWRldmljZU9TKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBib3RoVmVyc2lvbnNDYW5CZUNvZXJjZWQgPSBzZW12ZXIudmFsaWQoZGV2aWNlT1MpICYmIHNlbXZlci52YWxpZChwbGF0Zm9ybVZlcnNpb24pO1xuICAgICAgICBjb25zdCBib3RoVmVyc2lvbnNBcmVTdHJpbmdzID0gXy5pc1N0cmluZyhkZXZpY2VPUykgJiYgXy5pc1N0cmluZyhwbGF0Zm9ybVZlcnNpb24pO1xuICAgICAgICBpZiAoYm90aFZlcnNpb25zQ2FuQmVDb2VyY2VkICYmIGRldmljZU9TLnZlcnNpb24gPT09IHBsYXRmb3JtVmVyc2lvbi52ZXJzaW9uXG4gICAgICAgICAgICB8fCBib3RoVmVyc2lvbnNBcmVTdHJpbmdzICYmIF8udG9Mb3dlcihkZXZpY2VPUykgPT09IF8udG9Mb3dlcihwbGF0Zm9ybVZlcnNpb24pKSB7XG4gICAgICAgICAgLy8gR290IGFuIGV4YWN0IG1hdGNoIC0gcHJvY2VlZCBpbW1lZGlhdGVseVxuICAgICAgICAgIHVkaWQgPSBkZXZpY2UudWRpZDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfSBlbHNlIGlmICghYm90aFZlcnNpb25zQ2FuQmVDb2VyY2VkKSB7XG4gICAgICAgICAgLy8gVGhlcmUgaXMgbm8gcG9pbnQgdG8gY2hlY2sgZm9yIHBhcnRpYWwgbWF0Y2ggaWYgZWl0aGVyIG9mIHZlcnNpb24gbnVtYmVycyBpcyBub3QgY29lcmNpYmxlXG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoKCFfLmluY2x1ZGVzKG9wdHMucGxhdGZvcm1WZXJzaW9uLCAnLicpICYmIHBsYXRmb3JtVmVyc2lvbi5tYWpvciA9PT0gZGV2aWNlT1MubWFqb3JcbiAgICAgICAgICAgIHx8IHBsYXRmb3JtVmVyc2lvbi5tYWpvciA9PT0gZGV2aWNlT1MubWFqb3IgJiYgcGxhdGZvcm1WZXJzaW9uLm1pbm9yID09PSBkZXZpY2VPUy5taW5vcilcbiAgICAgICAgICAgIC8vIEdvdCBhIHBhcnRpYWwgbWF0Y2ggLSBtYWtlIHN1cmUgd2UgY29uc2lkZXIgdGhlIG1vc3QgcmVjZW50XG4gICAgICAgICAgICAvLyBkZXZpY2UgdmVyc2lvbiBhdmFpbGFibGUgb24gdGhlIGhvc3Qgc3lzdGVtXG4gICAgICAgICAgICAmJiAocGFydGlhbE1hdGNoQ2FuZGlkYXRlICYmIHNlbXZlci5ndChkZXZpY2VPUywgXy52YWx1ZXMocGFydGlhbE1hdGNoQ2FuZGlkYXRlKVswXSlcbiAgICAgICAgICAgICAgICB8fCAhcGFydGlhbE1hdGNoQ2FuZGlkYXRlKSkge1xuICAgICAgICAgIHBhcnRpYWxNYXRjaENhbmRpZGF0ZSA9IHtbZGV2aWNlLnVkaWRdOiBkZXZpY2VPU307XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghdWRpZCAmJiBwYXJ0aWFsTWF0Y2hDYW5kaWRhdGUpIHtcbiAgICAgICAgdWRpZCA9IF8ua2V5cyhwYXJ0aWFsTWF0Y2hDYW5kaWRhdGUpWzBdO1xuICAgICAgICBhd2FpdCBhZGIuc2V0RGV2aWNlSWQodWRpZCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdWRpZCkge1xuICAgICAgICAvLyB3ZSBjb3VsZG4ndCBmaW5kIGFueXRoaW5nISBxdWl0XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KGBVbmFibGUgdG8gZmluZCBhbiBhY3RpdmUgZGV2aWNlIG9yIGVtdWxhdG9yIGAgK1xuICAgICAgICAgIGB3aXRoIE9TICR7b3B0cy5wbGF0Zm9ybVZlcnNpb259LiBUaGUgZm9sbG93aW5nIGFyZSBhdmFpbGFibGU6IGAgK1xuICAgICAgICAgIGF2YWlsRGV2aWNlcy5qb2luKCcsICcpKTtcbiAgICAgIH1cblxuICAgICAgZW1Qb3J0ID0gYWRiLmdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmcodWRpZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGEgdWRpZCB3YXMgbm90IGdpdmVuLCBncmFiIHRoZSBmaXJzdCBkZXZpY2Ugd2Ugc2VlXG4gICAgICB1ZGlkID0gZGV2aWNlc1swXS51ZGlkO1xuICAgICAgZW1Qb3J0ID0gYWRiLmdldFBvcnRGcm9tRW11bGF0b3JTdHJpbmcodWRpZCk7XG4gICAgfVxuICB9XG5cbiAgbG9nZ2VyLmluZm8oYFVzaW5nIGRldmljZTogJHt1ZGlkfWApO1xuICByZXR1cm4ge3VkaWQsIGVtUG9ydH07XG59O1xuXG4vLyByZXR1cm5zIGEgbmV3IGFkYiBpbnN0YW5jZSB3aXRoIGRldmljZUlkIHNldFxuaGVscGVycy5jcmVhdGVBREIgPSBhc3luYyBmdW5jdGlvbiBjcmVhdGVBREIgKG9wdHMgPSB7fSkge1xuICBjb25zdCB7dWRpZCwgZW1Qb3J0fSA9IG9wdHM7XG4gIGNvbnN0IGFkYiA9IGF3YWl0IGhlbHBlcnMuY3JlYXRlQmFzZUFEQihvcHRzKTtcbiAgYWRiLnNldERldmljZUlkKHVkaWQpO1xuICBpZiAoZW1Qb3J0KSB7XG4gICAgYWRiLnNldEVtdWxhdG9yUG9ydChlbVBvcnQpO1xuICB9XG5cbiAgcmV0dXJuIGFkYjtcbn07XG5cbmhlbHBlcnMudmFsaWRhdGVQYWNrYWdlQWN0aXZpdHlOYW1lcyA9IGZ1bmN0aW9uIHZhbGlkYXRlUGFja2FnZUFjdGl2aXR5TmFtZXMgKG9wdHMpIHtcbiAgZm9yIChjb25zdCBrZXkgb2YgWydhcHBQYWNrYWdlJywgJ2FwcEFjdGl2aXR5JywgJ2FwcFdhaXRQYWNrYWdlJywgJ2FwcFdhaXRBY3Rpdml0eSddKSB7XG4gICAgY29uc3QgbmFtZSA9IG9wdHNba2V5XTtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnN0IG1hdGNoID0gLyhbXlxcdy4qLF0pKy8uZXhlYyhuYW1lKTtcbiAgICBpZiAoIW1hdGNoKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBsb2dnZXIud2FybihgQ2FwYWJpbGl0eSAnJHtrZXl9JyBpcyBleHBlY3RlZCB0byBvbmx5IGluY2x1ZGUgbGF0aW4gbGV0dGVycywgZGlnaXRzLCB1bmRlcnNjb3JlLCBkb3QsIGNvbW1hIGFuZCBhc3RlcmlzayBjaGFyYWN0ZXJzLmApO1xuICAgIGxvZ2dlci53YXJuKGBDdXJyZW50IHZhbHVlICcke25hbWV9JyBoYXMgbm9uLW1hdGNoaW5nIGNoYXJhY3RlciBhdCBpbmRleCAke21hdGNoLmluZGV4fTogJyR7bmFtZS5zdWJzdHJpbmcoMCwgbWF0Y2guaW5kZXggKyAxKX0nYCk7XG4gIH1cbn07XG5cbmhlbHBlcnMuZ2V0TGF1bmNoSW5mbyA9IGFzeW5jIGZ1bmN0aW9uIGdldExhdW5jaEluZm8gKGFkYiwgb3B0cykge1xuICBsZXQge2FwcCwgYXBwUGFja2FnZSwgYXBwQWN0aXZpdHksIGFwcFdhaXRQYWNrYWdlLCBhcHBXYWl0QWN0aXZpdHl9ID0gb3B0cztcbiAgaWYgKCFhcHApIHtcbiAgICBsb2dnZXIud2FybignTm8gYXBwIHNlbnQgaW4sIG5vdCBwYXJzaW5nIHBhY2thZ2UvYWN0aXZpdHknKTtcbiAgICByZXR1cm47XG4gIH1cblxuICB0aGlzLnZhbGlkYXRlUGFja2FnZUFjdGl2aXR5TmFtZXMob3B0cyk7XG5cbiAgaWYgKGFwcFBhY2thZ2UgJiYgYXBwQWN0aXZpdHkpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBsb2dnZXIuZGVidWcoJ1BhcnNpbmcgcGFja2FnZSBhbmQgYWN0aXZpdHkgZnJvbSBhcHAgbWFuaWZlc3QnKTtcbiAgbGV0IHthcGtQYWNrYWdlLCBhcGtBY3Rpdml0eX0gPVxuICAgIGF3YWl0IGFkYi5wYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QoYXBwKTtcbiAgaWYgKGFwa1BhY2thZ2UgJiYgIWFwcFBhY2thZ2UpIHtcbiAgICBhcHBQYWNrYWdlID0gYXBrUGFja2FnZTtcbiAgfVxuICBpZiAoIWFwcFdhaXRQYWNrYWdlKSB7XG4gICAgYXBwV2FpdFBhY2thZ2UgPSBhcHBQYWNrYWdlO1xuICB9XG4gIGlmIChhcGtBY3Rpdml0eSAmJiAhYXBwQWN0aXZpdHkpIHtcbiAgICBhcHBBY3Rpdml0eSA9IGFwa0FjdGl2aXR5O1xuICB9XG4gIGlmICghYXBwV2FpdEFjdGl2aXR5KSB7XG4gICAgYXBwV2FpdEFjdGl2aXR5ID0gYXBwQWN0aXZpdHk7XG4gIH1cbiAgbG9nZ2VyLmRlYnVnKGBQYXJzZWQgcGFja2FnZSBhbmQgYWN0aXZpdHkgYXJlOiAke2Fwa1BhY2thZ2V9LyR7YXBrQWN0aXZpdHl9YCk7XG4gIHJldHVybiB7YXBwUGFja2FnZSwgYXBwV2FpdFBhY2thZ2UsIGFwcEFjdGl2aXR5LCBhcHBXYWl0QWN0aXZpdHl9O1xufTtcblxuaGVscGVycy5yZXNldEFwcCA9IGFzeW5jIGZ1bmN0aW9uIHJlc2V0QXBwIChhZGIsIG9wdHMgPSB7fSkge1xuICBjb25zdCB7XG4gICAgYXBwLFxuICAgIGFwcFBhY2thZ2UsXG4gICAgZmFzdFJlc2V0LFxuICAgIGZ1bGxSZXNldCxcbiAgICBhbmRyb2lkSW5zdGFsbFRpbWVvdXQgPSBQQUNLQUdFX0lOU1RBTExfVElNRU9VVCxcbiAgICBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICBhbGxvd1Rlc3RQYWNrYWdlc1xuICB9ID0gb3B0cztcblxuICBpZiAoIWFwcFBhY2thZ2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCInYXBwUGFja2FnZScgb3B0aW9uIGlzIHJlcXVpcmVkXCIpO1xuICB9XG5cbiAgY29uc3QgaXNJbnN0YWxsZWQgPSBhd2FpdCBhZGIuaXNBcHBJbnN0YWxsZWQoYXBwUGFja2FnZSk7XG5cbiAgaWYgKGlzSW5zdGFsbGVkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFkYi5mb3JjZVN0b3AoYXBwUGFja2FnZSk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIC8vIGZ1bGxSZXNldCBoYXMgcHJpb3JpdHkgb3ZlciBmYXN0UmVzZXRcbiAgICBpZiAoIWZ1bGxSZXNldCAmJiBmYXN0UmVzZXQpIHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGF3YWl0IGFkYi5jbGVhcihhcHBQYWNrYWdlKTtcbiAgICAgIGlmIChfLmlzU3RyaW5nKG91dHB1dCkgJiYgb3V0cHV0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2ZhaWxlZCcpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNsZWFyIHRoZSBhcHBsaWNhdGlvbiBkYXRhIG9mICcke2FwcFBhY2thZ2V9Jy4gT3JpZ2luYWwgZXJyb3I6ICR7b3V0cHV0fWApO1xuICAgICAgfVxuICAgICAgLy8gZXhlY3V0aW5nIGBzaGVsbCBwbSBjbGVhcmAgcmVzZXRzIHByZXZpb3VzbHkgYXNzaWduZWQgYXBwbGljYXRpb24gcGVybWlzc2lvbnMgYXMgd2VsbFxuICAgICAgaWYgKGF1dG9HcmFudFBlcm1pc3Npb25zKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgYWRiLmdyYW50QWxsUGVybWlzc2lvbnMoYXBwUGFja2FnZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKGBVbmFibGUgdG8gZ3JhbnQgcGVybWlzc2lvbnMgcmVxdWVzdGVkLiBPcmlnaW5hbCBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsb2dnZXIuZGVidWcoYFBlcmZvcm1lZCBmYXN0IHJlc2V0IG9uIHRoZSBpbnN0YWxsZWQgJyR7YXBwUGFja2FnZX0nIGFwcGxpY2F0aW9uIChzdG9wIGFuZCBjbGVhcilgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICBpZiAoIWFwcCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIidhcHAnIG9wdGlvbiBpcyByZXF1aXJlZCBmb3IgcmVpbnN0YWxsXCIpO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKGBSdW5uaW5nIGZ1bGwgcmVzZXQgb24gJyR7YXBwUGFja2FnZX0nIChyZWluc3RhbGwpYCk7XG4gIGlmIChpc0luc3RhbGxlZCkge1xuICAgIGF3YWl0IGFkYi51bmluc3RhbGxBcGsoYXBwUGFja2FnZSk7XG4gIH1cbiAgYXdhaXQgYWRiLmluc3RhbGwoYXBwLCB7XG4gICAgZ3JhbnRQZXJtaXNzaW9uczogYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgdGltZW91dDogYW5kcm9pZEluc3RhbGxUaW1lb3V0LFxuICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICB9KTtcbn07XG5cbmhlbHBlcnMuaW5zdGFsbEFwayA9IGFzeW5jIGZ1bmN0aW9uIGluc3RhbGxBcGsgKGFkYiwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtcbiAgICBhcHAsXG4gICAgYXBwUGFja2FnZSxcbiAgICBmYXN0UmVzZXQsXG4gICAgZnVsbFJlc2V0LFxuICAgIGFuZHJvaWRJbnN0YWxsVGltZW91dCA9IFBBQ0tBR0VfSU5TVEFMTF9USU1FT1VULFxuICAgIGF1dG9HcmFudFBlcm1pc3Npb25zLFxuICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICAgIGVuZm9yY2VBcHBJbnN0YWxsLFxuICB9ID0gb3B0cztcblxuICBpZiAoIWFwcCB8fCAhYXBwUGFja2FnZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIidhcHAnIGFuZCAnYXBwUGFja2FnZScgb3B0aW9ucyBhcmUgcmVxdWlyZWRcIik7XG4gIH1cblxuICBpZiAoZnVsbFJlc2V0KSB7XG4gICAgYXdhaXQgdGhpcy5yZXNldEFwcChhZGIsIG9wdHMpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHtcbiAgICBhcHBTdGF0ZSxcbiAgICB3YXNVbmluc3RhbGxlZFxuICB9ID0gYXdhaXQgYWRiLmluc3RhbGxPclVwZ3JhZGUoYXBwLCBhcHBQYWNrYWdlLCB7XG4gICAgZ3JhbnRQZXJtaXNzaW9uczogYXV0b0dyYW50UGVybWlzc2lvbnMsXG4gICAgdGltZW91dDogYW5kcm9pZEluc3RhbGxUaW1lb3V0LFxuICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICAgIGVuZm9yY2VDdXJyZW50QnVpbGQ6IGVuZm9yY2VBcHBJbnN0YWxsLFxuICB9KTtcblxuICAvLyBUaGVyZSBpcyBubyBuZWVkIHRvIHJlc2V0IHRoZSBuZXdseSBpbnN0YWxsZWQgYXBwXG4gIGNvbnN0IGlzSW5zdGFsbGVkT3ZlckV4aXN0aW5nQXBwID0gIXdhc1VuaW5zdGFsbGVkXG4gICAgJiYgYXBwU3RhdGUgIT09IGFkYi5BUFBfSU5TVEFMTF9TVEFURS5OT1RfSU5TVEFMTEVEO1xuICBpZiAoZmFzdFJlc2V0ICYmIGlzSW5zdGFsbGVkT3ZlckV4aXN0aW5nQXBwKSB7XG4gICAgbG9nZ2VyLmluZm8oYFBlcmZvcm1pbmcgZmFzdCByZXNldCBvbiAnJHthcHBQYWNrYWdlfSdgKTtcbiAgICBhd2FpdCB0aGlzLnJlc2V0QXBwKGFkYiwgb3B0cyk7XG4gIH1cbn07XG5cbi8qKlxuICogSW5zdGFsbHMgYW4gYXJyYXkgb2YgYXBrc1xuICogQHBhcmFtIHtBREJ9IGFkYiBJbnN0YW5jZSBvZiBBcHBpdW0gQURCIG9iamVjdFxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMgT3B0cyBkZWZpbmVkIGluIGRyaXZlci5qc1xuICovXG5oZWxwZXJzLmluc3RhbGxPdGhlckFwa3MgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsT3RoZXJBcGtzIChvdGhlckFwcHMsIGFkYiwgb3B0cykge1xuICBsZXQge1xuICAgIGFuZHJvaWRJbnN0YWxsVGltZW91dCA9IFBBQ0tBR0VfSU5TVEFMTF9USU1FT1VULFxuICAgIGF1dG9HcmFudFBlcm1pc3Npb25zLFxuICAgIGFsbG93VGVzdFBhY2thZ2VzXG4gIH0gPSBvcHRzO1xuXG4gIC8vIEluc3RhbGwgYWxsIG9mIHRoZSBBUEsncyBhc3luY2hyb25vdXNseVxuICBhd2FpdCBCLmFsbChvdGhlckFwcHMubWFwKChvdGhlckFwcCkgPT4ge1xuICAgIGxvZ2dlci5kZWJ1ZyhgSW5zdGFsbGluZyBhcHA6ICR7b3RoZXJBcHB9YCk7XG4gICAgcmV0dXJuIGFkYi5pbnN0YWxsT3JVcGdyYWRlKG90aGVyQXBwLCBudWxsLCB7XG4gICAgICBncmFudFBlcm1pc3Npb25zOiBhdXRvR3JhbnRQZXJtaXNzaW9ucyxcbiAgICAgIHRpbWVvdXQ6IGFuZHJvaWRJbnN0YWxsVGltZW91dCxcbiAgICAgIGFsbG93VGVzdFBhY2thZ2VzLFxuICAgIH0pO1xuICB9KSk7XG59O1xuXG4vKipcbiAqIFVuaW5zdGFsbCBhbiBhcnJheSBvZiBwYWNrYWdlc1xuICogQHBhcmFtIHtBREJ9IGFkYiBJbnN0YW5jZSBvZiBBcHBpdW0gQURCIG9iamVjdFxuICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBhcHBQYWNrYWdlcyBBbiBhcnJheSBvZiBwYWNrYWdlIG5hbWVzIHRvIHVuaW5zdGFsbC4gSWYgdGhpcyBpbmNsdWRlcyBgJyonYCwgdW5pbnN0YWxsIGFsbCBvZiAzcmQgcGFydHkgYXBwc1xuICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBmaWx0ZXJQYWNrYWdlcyBBbiBhcnJheSBvZiBwYWNrYWdlcyBkb2VzIG5vdCB1bmluc3RhbGwgd2hlbiBgKmAgaXMgcHJvdmlkZWQgYXMgYGFwcFBhY2thZ2VzYFxuICovXG5oZWxwZXJzLnVuaW5zdGFsbE90aGVyUGFja2FnZXMgPSBhc3luYyBmdW5jdGlvbiB1bmluc3RhbGxPdGhlclBhY2thZ2VzIChhZGIsIGFwcFBhY2thZ2VzLCBmaWx0ZXJQYWNrYWdlcyA9IFtdKSB7XG4gIGlmIChhcHBQYWNrYWdlcy5pbmNsdWRlcygnKicpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdVbmluc3RhbGwgdGhpcmQgcGFydHkgcGFja2FnZXMnKTtcbiAgICBhcHBQYWNrYWdlcyA9IGF3YWl0IHRoaXMuZ2V0VGhpcmRQYXJ0eVBhY2thZ2VzKGFkYiwgZmlsdGVyUGFja2FnZXMpO1xuICB9XG5cbiAgbG9nZ2VyLmRlYnVnKGBVbmluc3RhbGxpbmcgcGFja2FnZXM6ICR7YXBwUGFja2FnZXN9YCk7XG4gIGF3YWl0IEIuYWxsKGFwcFBhY2thZ2VzLm1hcCgoYXBwUGFja2FnZSkgPT4gYWRiLnVuaW5zdGFsbEFwayhhcHBQYWNrYWdlKSkpO1xufTtcblxuLyoqXG4gKiBHZXQgdGhpcmQgcGFydHkgcGFja2FnZXMgZmlsdGVyZWQgd2l0aCBgZmlsdGVyUGFja2FnZXNgXG4gKiBAcGFyYW0ge0FEQn0gYWRiIEluc3RhbmNlIG9mIEFwcGl1bSBBREIgb2JqZWN0XG4gKiBAcGFyYW0ge0FycmF5PHN0cmluZz59IGZpbHRlclBhY2thZ2VzIEFuIGFycmF5IG9mIHBhY2thZ2VzIGRvZXMgbm90IHVuaW5zdGFsbCB3aGVuIGAqYCBpcyBwcm92aWRlZCBhcyBgYXBwUGFja2FnZXNgXG4gKiBAcmV0dXJucyB7QXJyYXk8c3RyaW5nPn0gQW4gYXJyYXkgb2YgaW5zdGFsbGVkIHRoaXJkIHBhcnkgcGFja2FnZXNcbiAqL1xuaGVscGVycy5nZXRUaGlyZFBhcnR5UGFja2FnZXMgPSBhc3luYyBmdW5jdGlvbiBnZXRUaGlyZFBhcnR5UGFja2FnZXMgKGFkYiwgZmlsdGVyUGFja2FnZXMgPSBbXSkge1xuICB0cnkge1xuICAgIGNvbnN0IHBhY2thZ2VzU3RyaW5nID0gYXdhaXQgYWRiLnNoZWxsKFsncG0nLCAnbGlzdCcsICdwYWNrYWdlcycsICctMyddKTtcbiAgICBjb25zdCBhcHBQYWNrYWdlc0FycmF5ID0gcGFja2FnZXNTdHJpbmcudHJpbSgpLnJlcGxhY2UoL3BhY2thZ2U6L2csICcnKS5zcGxpdChFT0wpO1xuICAgIGxvZ2dlci5kZWJ1ZyhgJyR7YXBwUGFja2FnZXNBcnJheX0nIGZpbHRlcmVkIHdpdGggJyR7ZmlsdGVyUGFja2FnZXN9J2ApO1xuICAgIHJldHVybiBfLmRpZmZlcmVuY2UoYXBwUGFja2FnZXNBcnJheSwgZmlsdGVyUGFja2FnZXMpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2dnZXIud2FybihgVW5hYmxlIHRvIGdldCBwYWNrYWdlcyB3aXRoICdhZGIgc2hlbGwgcG0gbGlzdCBwYWNrYWdlcyAtMyc6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59O1xuXG5oZWxwZXJzLmluaXRVbmljb2RlS2V5Ym9hcmQgPSBhc3luYyBmdW5jdGlvbiBpbml0VW5pY29kZUtleWJvYXJkIChhZGIpIHtcbiAgbG9nZ2VyLmRlYnVnKCdFbmFibGluZyBVbmljb2RlIGtleWJvYXJkIHN1cHBvcnQnKTtcblxuICAvLyBnZXQgdGhlIGRlZmF1bHQgSU1FIHNvIHdlIGNhbiByZXR1cm4gYmFjayB0byBpdCBsYXRlciBpZiB3ZSB3YW50XG4gIGxldCBkZWZhdWx0SU1FID0gYXdhaXQgYWRiLmRlZmF1bHRJTUUoKTtcblxuICBsb2dnZXIuZGVidWcoYFVuc2V0dGluZyBwcmV2aW91cyBJTUUgJHtkZWZhdWx0SU1FfWApO1xuICBjb25zdCBhcHBpdW1JTUUgPSBgJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfS8uVW5pY29kZUlNRWA7XG4gIGxvZ2dlci5kZWJ1ZyhgU2V0dGluZyBJTUUgdG8gJyR7YXBwaXVtSU1FfSdgKTtcbiAgYXdhaXQgYWRiLmVuYWJsZUlNRShhcHBpdW1JTUUpO1xuICBhd2FpdCBhZGIuc2V0SU1FKGFwcGl1bUlNRSk7XG4gIHJldHVybiBkZWZhdWx0SU1FO1xufTtcblxuaGVscGVycy5zZXRNb2NrTG9jYXRpb25BcHAgPSBhc3luYyBmdW5jdGlvbiBzZXRNb2NrTG9jYXRpb25BcHAgKGFkYiwgYXBwKSB7XG4gIHRyeSB7XG4gICAgaWYgKGF3YWl0IGFkYi5nZXRBcGlMZXZlbCgpIDwgMjMpIHtcbiAgICAgIGF3YWl0IGFkYi5zaGVsbChbJ3NldHRpbmdzJywgJ3B1dCcsICdzZWN1cmUnLCAnbW9ja19sb2NhdGlvbicsICcxJ10pO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBhZGIuc2hlbGwoWydhcHBvcHMnLCAnc2V0JywgYXBwLCAnYW5kcm9pZDptb2NrX2xvY2F0aW9uJywgJ2FsbG93J10pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLndhcm4oYFVuYWJsZSB0byBzZXQgbW9jayBsb2NhdGlvbiBmb3IgYXBwICcke2FwcH0nOiAke2Vyci5tZXNzYWdlfWApO1xuICB9XG59O1xuXG5oZWxwZXJzLmluc3RhbGxIZWxwZXJBcHAgPSBhc3luYyBmdW5jdGlvbiBpbnN0YWxsSGVscGVyQXBwIChhZGIsIGFwa1BhdGgsIHBhY2thZ2VJZCkge1xuICAvLyBTb21ldGltZXMgYWRiIHB1c2ggb3IgYWRiIGluc3RhbCB0YWtlIG1vcmUgdGltZSB0aGFuIGV4cGVjdGVkIHRvIGluc3RhbGwgYW4gYXBwXG4gIC8vIGUuZy4gaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9pby5hcHBpdW0uc2V0dGluZ3MvaXNzdWVzLzQwI2lzc3VlY29tbWVudC00NzY1OTMxNzRcbiAgYXdhaXQgcmV0cnkoMiwgYXN5bmMgZnVuY3Rpb24gcmV0cnlJbnN0YWxsSGVscGVyQXBwICgpIHtcbiAgICBhd2FpdCBhZGIuaW5zdGFsbE9yVXBncmFkZShhcGtQYXRoLCBwYWNrYWdlSWQsIHtncmFudFBlcm1pc3Npb25zOiB0cnVlfSk7XG4gIH0pO1xufTtcblxuLyoqXG4gKiBQdXNoZXMgYW5kIGluc3RhbGxzIGlvLmFwcGl1bS5zZXR0aW5ncyBhcHAuXG4gKiBUaHJvd3MgYW4gZXJyb3IgaWYgdGhlIHNldHRpbmcgYXBwIGlzIHJlcXVpcmVkXG4gKlxuICogQHBhcmFtIHtBZGJ9IGFkYiAtIFRoZSBhZGIgbW9kdWxlIGluc3RhbmNlLlxuICogQHBhcmFtIHtib29sZWFufSB0aHJvd0Vycm9yW2ZhbHNlXSAtIFdoZXRoZXIgdGhyb3cgZXJyb3Igb3Igbm90XG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhyb3dFcnJvciBpcyB0cnVlIGFuZCBzb21ldGhpbmcgaGFwcGVucyBpbiBpbnN0YWxsYXRpb24gc3RlcFxuICovXG5oZWxwZXJzLnB1c2hTZXR0aW5nc0FwcCA9IGFzeW5jIGZ1bmN0aW9uIHB1c2hTZXR0aW5nc0FwcCAoYWRiLCB0aHJvd0Vycm9yID0gZmFsc2UpIHtcbiAgbG9nZ2VyLmRlYnVnKCdQdXNoaW5nIHNldHRpbmdzIGFwayB0byBkZXZpY2UuLi4nKTtcblxuICB0cnkge1xuICAgIGF3YWl0IGhlbHBlcnMuaW5zdGFsbEhlbHBlckFwcChhZGIsIHNldHRpbmdzQXBrUGF0aCwgU0VUVElOR1NfSEVMUEVSX1BLR19JRCwgdGhyb3dFcnJvcik7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGlmICh0aHJvd0Vycm9yKSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuXG4gICAgbG9nZ2VyLndhcm4oYElnbm9yZWQgZXJyb3Igd2hpbGUgaW5zdGFsbGluZyAnJHtzZXR0aW5nc0Fwa1BhdGh9JzogYCArXG4gICAgICAgICAgICAgICAgYCcke2Vyci5tZXNzYWdlfScuIEZlYXR1cmVzIHRoYXQgcmVseSBvbiB0aGlzIGhlbHBlciBgICtcbiAgICAgICAgICAgICAgICAncmVxdWlyZSB0aGUgYXBrIHN1Y2ggYXMgdG9nZ2xlIFdpRmkgYW5kIGdldHRpbmcgbG9jYXRpb24gJyArXG4gICAgICAgICAgICAgICAgJ3dpbGwgcmFpc2UgYW4gZXJyb3IgaWYgeW91IHRyeSB0byB1c2UgdGhlbS4nKTtcbiAgfVxuXG4gIC8vIFJlaW5zdGFsbCB3aWxsIHN0b3AgdGhlIHNldHRpbmdzIGhlbHBlciBwcm9jZXNzIGFueXdheSwgc29cbiAgLy8gdGhlcmUgaXMgbm8gbmVlZCB0byBjb250aW51ZSBpZiB0aGUgYXBwbGljYXRpb24gaXMgc3RpbGwgcnVubmluZ1xuICBpZiAoYXdhaXQgYWRiLnByb2Nlc3NFeGlzdHMoU0VUVElOR1NfSEVMUEVSX1BLR19JRCkpIHtcbiAgICBsb2dnZXIuZGVidWcoYCR7U0VUVElOR1NfSEVMUEVSX1BLR19JRH0gaXMgYWxyZWFkeSBydW5uaW5nLiBgICtcbiAgICAgIGBUaGVyZSBpcyBubyBuZWVkIHRvIHJlc2V0IGl0cyBwZXJtaXNzaW9ucy5gKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoYXdhaXQgYWRiLmdldEFwaUxldmVsKCkgPD0gMjMpIHsgLy8gQW5kcm9pZCA2LSBkZXZpY2VzIHNob3VsZCBoYXZlIGdyYW50ZWQgcGVybWlzc2lvbnNcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9wdWxsLzExNjQwI2lzc3VlY29tbWVudC00MzgyNjA0NzdcbiAgICBjb25zdCBwZXJtcyA9IFsnU0VUX0FOSU1BVElPTl9TQ0FMRScsICdDSEFOR0VfQ09ORklHVVJBVElPTicsICdBQ0NFU1NfRklORV9MT0NBVElPTiddO1xuICAgIGxvZ2dlci5pbmZvKGBHcmFudGluZyBwZXJtaXNzaW9ucyAke3Blcm1zfSB0byAnJHtTRVRUSU5HU19IRUxQRVJfUEtHX0lEfSdgKTtcbiAgICBhd2FpdCBhZGIuZ3JhbnRQZXJtaXNzaW9ucyhTRVRUSU5HU19IRUxQRVJfUEtHX0lELCBwZXJtcy5tYXAoKHgpID0+IGBhbmRyb2lkLnBlcm1pc3Npb24uJHt4fWApKTtcbiAgfVxuXG4gIC8vIGxhdW5jaCBpby5hcHBpdW0uc2V0dGluZ3MgYXBwIGR1ZSB0byBzZXR0aW5ncyBmYWlsaW5nIHRvIGJlIHNldFxuICAvLyBpZiB0aGUgYXBwIGlzIG5vdCBsYXVuY2hlZCBwcmlvciB0byBzdGFydCB0aGUgc2Vzc2lvbiBvbiBhbmRyb2lkIDcrXG4gIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9pc3N1ZXMvODk1N1xuICB0cnkge1xuICAgIGF3YWl0IGFkYi5yZXF1aXJlUnVubmluZ1NldHRpbmdzQXBwKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci5kZWJ1ZyhlcnIpO1xuICAgIGlmICh0aHJvd0Vycm9yKSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIEV4dHJhY3RzIHN0cmluZy54bWwgYW5kIGNvbnZlcnRzIGl0IHRvIHN0cmluZy5qc29uIGFuZCBwdXNoZXNcbiAqIGl0IHRvIC9kYXRhL2xvY2FsL3RtcC9zdHJpbmcuanNvbiBvbiBmb3IgdXNlIG9mIGJvb3RzdHJhcFxuICogSWYgYXBwIGlzIG5vdCBwcmVzZW50IHRvIGV4dHJhY3Qgc3RyaW5nLnhtbCBpdCBkZWxldGVzIHJlbW90ZSBzdHJpbmdzLmpzb25cbiAqIElmIGFwcCBkb2VzIG5vdCBoYXZlIHN0cmluZ3MueG1sIHdlIHB1c2ggYW4gZW1wdHkganNvbiBvYmplY3QgdG8gcmVtb3RlXG4gKlxuICogQHBhcmFtIHs/c3RyaW5nfSBsYW5ndWFnZSAtIExhbmd1YWdlIGFiYnJldmlhdGlvbiwgZm9yIGV4YW1wbGUgJ2ZyJy4gVGhlIGRlZmF1bHQgbGFuZ3VhZ2VcbiAqIGlzIHVzZWQgaWYgdGhpcyBhcmd1bWVudCBpcyBub3QgZGVmaW5lZC5cbiAqIEBwYXJhbSB7T2JqZWN0fSBhZGIgLSBUaGUgYWRiIG1vZHVsZSBpbnN0YW5jZS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIC0gRHJpdmVyIG9wdGlvbnMgZGljdGlvbmFyeS5cbiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBkaWN0aW9uYXJ5LCB3aGVyZSBzdHJpbmcgcmVzb3VyY2UgaWRlbnRpZmllcnMgYXJlIGtleXNcbiAqIGFsb25nIHdpdGggdGhlaXIgY29ycmVzcG9uZGluZyB2YWx1ZXMgZm9yIHRoZSBnaXZlbiBsYW5ndWFnZSBvciBhbiBlbXB0eSBvYmplY3RcbiAqIGlmIG5vIG1hdGNoaW5nIHJlc291cmNlcyB3ZXJlIGV4dHJhY3RlZC5cbiAqL1xuaGVscGVycy5wdXNoU3RyaW5ncyA9IGFzeW5jIGZ1bmN0aW9uIHB1c2hTdHJpbmdzIChsYW5ndWFnZSwgYWRiLCBvcHRzKSB7XG4gIGNvbnN0IHJlbW90ZURpciA9ICcvZGF0YS9sb2NhbC90bXAnO1xuICBjb25zdCBzdHJpbmdzSnNvbiA9ICdzdHJpbmdzLmpzb24nO1xuICBjb25zdCByZW1vdGVGaWxlID0gcGF0aC5wb3NpeC5yZXNvbHZlKHJlbW90ZURpciwgc3RyaW5nc0pzb24pO1xuXG4gIC8vIGNsZWFuIHVwIHJlbW90ZSBzdHJpbmcuanNvbiBpZiBwcmVzZW50XG4gIGF3YWl0IGFkYi5yaW1yYWYocmVtb3RlRmlsZSk7XG5cbiAgbGV0IGFwcDtcbiAgdHJ5IHtcbiAgICBhcHAgPSBvcHRzLmFwcCB8fCBhd2FpdCBhZGIucHVsbEFwayhvcHRzLmFwcFBhY2thZ2UsIG9wdHMudG1wRGlyKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLmluZm8oYEZhaWxlZCB0byBwdWxsIGFuIGFwayBmcm9tICcke29wdHMuYXBwUGFja2FnZX0nIHRvICcke29wdHMudG1wRGlyfScuIE9yaWdpbmFsIGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICB9XG5cbiAgaWYgKF8uaXNFbXB0eShvcHRzLmFwcFBhY2thZ2UpIHx8ICEoYXdhaXQgZnMuZXhpc3RzKGFwcCkpKSB7XG4gICAgbG9nZ2VyLmRlYnVnKGBObyBhcHAgb3IgcGFja2FnZSBzcGVjaWZpZWQuIFJldHVybmluZyBlbXB0eSBzdHJpbmdzYCk7XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgY29uc3Qgc3RyaW5nc1RtcERpciA9IHBhdGgucmVzb2x2ZShvcHRzLnRtcERpciwgb3B0cy5hcHBQYWNrYWdlKTtcbiAgdHJ5IHtcbiAgICBsb2dnZXIuZGVidWcoJ0V4dHJhY3Rpbmcgc3RyaW5ncyBmcm9tIGFwaycsIGFwcCwgbGFuZ3VhZ2UsIHN0cmluZ3NUbXBEaXIpO1xuICAgIGNvbnN0IHthcGtTdHJpbmdzLCBsb2NhbFBhdGh9ID0gYXdhaXQgYWRiLmV4dHJhY3RTdHJpbmdzRnJvbUFwayhhcHAsIGxhbmd1YWdlLCBzdHJpbmdzVG1wRGlyKTtcbiAgICBhd2FpdCBhZGIucHVzaChsb2NhbFBhdGgsIHJlbW90ZURpcik7XG4gICAgcmV0dXJuIGFwa1N0cmluZ3M7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZ2dlci53YXJuKGBDb3VsZCBub3QgZ2V0IHN0cmluZ3MsIGNvbnRpbnVpbmcgYW55d2F5LiBPcmlnaW5hbCBlcnJvcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICBhd2FpdCBhZGIuc2hlbGwoJ2VjaG8nLCBbYCd7fScgPiAke3JlbW90ZUZpbGV9YF0pO1xuICB9IGZpbmFsbHkge1xuICAgIGF3YWl0IGZzLnJpbXJhZihzdHJpbmdzVG1wRGlyKTtcbiAgfVxuICByZXR1cm4ge307XG59O1xuXG5oZWxwZXJzLnVubG9ja1dpdGhVSUF1dG9tYXRpb24gPSBhc3luYyBmdW5jdGlvbiB1bmxvY2tXaXRoVUlBdXRvbWF0aW9uIChkcml2ZXIsIGFkYiwgdW5sb2NrQ2FwYWJpbGl0aWVzKSB7XG4gIGxldCB1bmxvY2tUeXBlID0gdW5sb2NrQ2FwYWJpbGl0aWVzLnVubG9ja1R5cGU7XG4gIGlmICghdW5sb2NrZXIuaXNWYWxpZFVubG9ja1R5cGUodW5sb2NrVHlwZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgdW5sb2NrIHR5cGUgJHt1bmxvY2tUeXBlfWApO1xuICB9XG4gIGxldCB1bmxvY2tLZXkgPSB1bmxvY2tDYXBhYmlsaXRpZXMudW5sb2NrS2V5O1xuICBpZiAoIXVubG9ja2VyLmlzVmFsaWRLZXkodW5sb2NrVHlwZSwgdW5sb2NrS2V5KSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyB1bmxvY2tLZXkgJHt1bmxvY2tLZXl9IGNhcGFiaWxpdHkgZm9yIHVubG9ja1R5cGUgJHt1bmxvY2tUeXBlfWApO1xuICB9XG4gIGNvbnN0IHVubG9ja01ldGhvZCA9IHtcbiAgICBbUElOX1VOTE9DS106IHVubG9ja2VyLnBpblVubG9jayxcbiAgICBbUEFTU1dPUkRfVU5MT0NLXTogdW5sb2NrZXIucGFzc3dvcmRVbmxvY2ssXG4gICAgW1BBVFRFUk5fVU5MT0NLXTogdW5sb2NrZXIucGF0dGVyblVubG9jayxcbiAgICBbRklOR0VSUFJJTlRfVU5MT0NLXTogdW5sb2NrZXIuZmluZ2VycHJpbnRVbmxvY2tcbiAgfVt1bmxvY2tUeXBlXTtcbiAgYXdhaXQgdW5sb2NrTWV0aG9kKGFkYiwgZHJpdmVyLCB1bmxvY2tDYXBhYmlsaXRpZXMpO1xufTtcblxuaGVscGVycy51bmxvY2tXaXRoSGVscGVyQXBwID0gYXN5bmMgZnVuY3Rpb24gdW5sb2NrV2l0aEhlbHBlckFwcCAoYWRiKSB7XG4gIGxvZ2dlci5pbmZvKCdVbmxvY2tpbmcgc2NyZWVuJyk7XG5cbiAgLy8gVW5sb2NrIHN1Y2NlZWQgd2l0aCBhIGNvdXBsZSBvZiByZXRyaWVzLlxuICBsZXQgZmlyc3RSdW4gPSB0cnVlO1xuICBhd2FpdCByZXRyeSgzLCBhc3luYyBmdW5jdGlvbiBsYXVuY2hIZWxwZXIgKCkge1xuICAgIC8vIFRvIHJlZHVjZSBhIHRpbWUgdG8gY2FsbCBhZGIuaXNTY3JlZW5Mb2NrZWQoKSBzaW5jZSBgYWRiIHNoZWxsIGR1bXBzeXMgd2luZG93YCBpcyBlYXN5IHRvIGhhbmcgYWRiIGNvbW1hbmRzXG4gICAgaWYgKGZpcnN0UnVuKSB7XG4gICAgICBmaXJzdFJ1biA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoIShhd2FpdCBhZGIuaXNTY3JlZW5Mb2NrZWQoKSkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oYEVycm9yIGluIGlzU2NyZWVuTG9ja2VkOiAke2UubWVzc2FnZX1gKTtcbiAgICAgICAgbG9nZ2VyLndhcm4oJ1wiYWRiIHNoZWxsIGR1bXBzeXMgd2luZG93XCIgY29tbWFuZCBoYXMgdGltZWQgb3V0LicpO1xuICAgICAgICBsb2dnZXIud2FybignVGhlIHJlYXNvbiBvZiB0aGlzIHRpbWVvdXQgaXMgdGhlIGRlbGF5ZWQgYWRiIHJlc3BvbnNlLiBSZXNldHRpbmcgYWRiIHNlcnZlciBjYW4gaW1wcm92ZSBpdC4nKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsb2dnZXIuaW5mbyhgTGF1bmNoaW5nICR7U0VUVElOR1NfSEVMUEVSX1VOTE9DS19BQ1RJVklUWX1gKTtcbiAgICBhd2FpdCBhZGIuc2hlbGwoW1xuICAgICAgJ2FtJywgJ3N0YXJ0JyxcbiAgICAgICctbicsIGAke1NFVFRJTkdTX0hFTFBFUl9QS0dfSUR9LyR7U0VUVElOR1NfSEVMUEVSX1VOTE9DS19BQ1RJVklUWX1gLFxuICAgICAgJy1jJywgJ2FuZHJvaWQuaW50ZW50LmNhdGVnb3J5LkxBVU5DSEVSJyxcbiAgICAgICctYScsICdhbmRyb2lkLmludGVudC5hY3Rpb24uTUFJTicsXG4gICAgICAnLWYnLCAnMHgxMDIwMDAwMCcsXG4gICAgXSk7XG4gICAgYXdhaXQgQi5kZWxheSgxMDAwKTtcbiAgfSk7XG59O1xuXG5oZWxwZXJzLnVubG9jayA9IGFzeW5jIGZ1bmN0aW9uIHVubG9jayAoZHJpdmVyLCBhZGIsIGNhcGFiaWxpdGllcykge1xuICBpZiAoIShhd2FpdCBhZGIuaXNTY3JlZW5Mb2NrZWQoKSkpIHtcbiAgICBsb2dnZXIuaW5mbygnU2NyZWVuIGFscmVhZHkgdW5sb2NrZWQsIGRvaW5nIG5vdGhpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsb2dnZXIuZGVidWcoJ1NjcmVlbiBpcyBsb2NrZWQsIHRyeWluZyB0byB1bmxvY2snKTtcbiAgaWYgKF8uaXNVbmRlZmluZWQoY2FwYWJpbGl0aWVzLnVubG9ja1R5cGUpKSB7XG4gICAgbG9nZ2VyLndhcm4oJ1VzaW5nIGFwcCB1bmxvY2ssIHRoaXMgaXMgZ29pbmcgdG8gYmUgZGVwcmVjYXRlZCEnKTtcbiAgICBhd2FpdCBoZWxwZXJzLnVubG9ja1dpdGhIZWxwZXJBcHAoYWRiKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBoZWxwZXJzLnVubG9ja1dpdGhVSUF1dG9tYXRpb24oZHJpdmVyLCBhZGIsIHt1bmxvY2tUeXBlOiBjYXBhYmlsaXRpZXMudW5sb2NrVHlwZSwgdW5sb2NrS2V5OiBjYXBhYmlsaXRpZXMudW5sb2NrS2V5fSk7XG4gICAgYXdhaXQgaGVscGVycy52ZXJpZnlVbmxvY2soYWRiLCBjYXBhYmlsaXRpZXMudW5sb2NrU3VjY2Vzc1RpbWVvdXQpO1xuICB9XG59O1xuXG5oZWxwZXJzLnZlcmlmeVVubG9jayA9IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeVVubG9jayAoYWRiLCB1bmxvY2tTdWNjZXNzVGltZW91dCkge1xuICBsZXQgc3VjY2Vzc1RpbWVvdXQgPSB1bmxvY2tTdWNjZXNzVGltZW91dCB8fCAyMDAwO1xuICBhd2FpdCByZXRyeUludGVydmFsKHN1Y2Nlc3NUaW1lb3V0IC8gMTAwMCwgc3VjY2Vzc1RpbWVvdXQsIGFzeW5jICgpID0+IHtcbiAgICBpZiAoYXdhaXQgYWRiLmlzU2NyZWVuTG9ja2VkKCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU2NyZWVuIGRpZCBub3QgdW5sb2NrIHN1Y2Nlc3NmdWxseSwgcmV0cnlpbmcnKTtcbiAgICB9XG4gICAgbG9nZ2VyLmRlYnVnKCdTY3JlZW4gdW5sb2NrZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gIH0pO1xufTtcblxuaGVscGVycy5pbml0RGV2aWNlID0gYXN5bmMgZnVuY3Rpb24gaW5pdERldmljZSAoYWRiLCBvcHRzKSB7XG4gIGlmIChvcHRzLnNraXBEZXZpY2VJbml0aWFsaXphdGlvbikge1xuICAgIGxvZ2dlci5pbmZvKGAnc2tpcERldmljZUluaXRpYWxpemF0aW9uJyBpcyBzZXQuIFNraXBwaW5nIGRldmljZSBpbml0aWFsaXphdGlvbi5gKTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBhZGIud2FpdEZvckRldmljZSgpO1xuICAgIC8vIHB1c2hTZXR0aW5nc0FwcCByZXF1aXJlZCBiZWZvcmUgY2FsbGluZyBlbnN1cmVEZXZpY2VMb2NhbGUgZm9yIEFQSSBMZXZlbCAyNCtcblxuICAgIC8vIFNvbWUgZmVhdHVyZSBzdWNoIGFzIGxvY2F0aW9uL3dpZmkgYXJlIG5vdCBuZWNlc3NhcnkgZm9yIGFsbCB1c2VycyxcbiAgICAvLyBidXQgdGhleSByZXF1aXJlIHRoZSBzZXR0aW5ncyBhcHAuIFNvLCB0cnkgdG8gY29uZmlndXJlIGl0IHdoaWxlIEFwcGl1bVxuICAgIC8vIGRvZXMgbm90IHRocm93IGVycm9yIGV2ZW4gaWYgdGhleSBmYWlsLlxuICAgIGNvbnN0IHNob3VsZFRocm93RXJyb3IgPSBvcHRzLmxhbmd1YWdlXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHx8IG9wdHMubG9jYWxlXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHx8IG9wdHMubG9jYWxlU2NyaXB0XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHx8IG9wdHMudW5pY29kZUtleWJvYXJkXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHx8IG9wdHMuZGlzYWJsZVdpbmRvd0FuaW1hdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICB8fCAhb3B0cy5za2lwVW5sb2NrO1xuICAgIGF3YWl0IGhlbHBlcnMucHVzaFNldHRpbmdzQXBwKGFkYiwgc2hvdWxkVGhyb3dFcnJvcik7XG4gIH1cblxuICBpZiAoIW9wdHMuYXZkKSB7XG4gICAgYXdhaXQgaGVscGVycy5zZXRNb2NrTG9jYXRpb25BcHAoYWRiLCBTRVRUSU5HU19IRUxQRVJfUEtHX0lEKTtcbiAgfVxuXG4gIGlmIChvcHRzLmxhbmd1YWdlIHx8IG9wdHMubG9jYWxlKSB7XG4gICAgYXdhaXQgaGVscGVycy5lbnN1cmVEZXZpY2VMb2NhbGUoYWRiLCBvcHRzLmxhbmd1YWdlLCBvcHRzLmxvY2FsZSwgb3B0cy5sb2NhbGVTY3JpcHQpO1xuICB9XG5cbiAgaWYgKG9wdHMuc2tpcExvZ2NhdENhcHR1cmUpIHtcbiAgICBsb2dnZXIuaW5mbyhgJ3NraXBMb2djYXRDYXB0dXJlJyBpcyBzZXQuIFNraXBwaW5nIHN0YXJ0aW5nIGxvZ2NhdCBjYXB0dXJlLmApO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IGFkYi5zdGFydExvZ2NhdCgpO1xuICB9XG5cbiAgaWYgKG9wdHMudW5pY29kZUtleWJvYXJkKSB7XG4gICAgcmV0dXJuIGF3YWl0IGhlbHBlcnMuaW5pdFVuaWNvZGVLZXlib2FyZChhZGIpO1xuICB9XG59O1xuXG5oZWxwZXJzLnJlbW92ZU51bGxQcm9wZXJ0aWVzID0gZnVuY3Rpb24gcmVtb3ZlTnVsbFByb3BlcnRpZXMgKG9iaikge1xuICBmb3IgKGxldCBrZXkgb2YgXy5rZXlzKG9iaikpIHtcbiAgICBpZiAoXy5pc051bGwob2JqW2tleV0pIHx8IF8uaXNVbmRlZmluZWQob2JqW2tleV0pKSB7XG4gICAgICBkZWxldGUgb2JqW2tleV07XG4gICAgfVxuICB9XG59O1xuXG5oZWxwZXJzLnRydW5jYXRlRGVjaW1hbHMgPSBmdW5jdGlvbiB0cnVuY2F0ZURlY2ltYWxzIChudW1iZXIsIGRpZ2l0cykge1xuICBsZXQgbXVsdGlwbGllciA9IE1hdGgucG93KDEwLCBkaWdpdHMpLFxuICAgICAgYWRqdXN0ZWROdW0gPSBudW1iZXIgKiBtdWx0aXBsaWVyLFxuICAgICAgdHJ1bmNhdGVkTnVtID0gTWF0aFthZGp1c3RlZE51bSA8IDAgPyAnY2VpbCcgOiAnZmxvb3InXShhZGp1c3RlZE51bSk7XG5cbiAgcmV0dXJuIHRydW5jYXRlZE51bSAvIG11bHRpcGxpZXI7XG59O1xuXG5oZWxwZXJzLmlzQ2hyb21lQnJvd3NlciA9IGZ1bmN0aW9uIGlzQ2hyb21lQnJvd3NlciAoYnJvd3Nlcikge1xuICByZXR1cm4gXy5pbmNsdWRlcyhPYmplY3Qua2V5cyhDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZKSwgKGJyb3dzZXIgfHwgJycpLnRvTG93ZXJDYXNlKCkpO1xufTtcblxuaGVscGVycy5nZXRDaHJvbWVQa2cgPSBmdW5jdGlvbiBnZXRDaHJvbWVQa2cgKGJyb3dzZXIpIHtcbiAgcmV0dXJuIENIUk9NRV9CUk9XU0VSX1BBQ0tBR0VfQUNUSVZJVFlbYnJvd3Nlci50b0xvd2VyQ2FzZSgpXSB8fCBDSFJPTUVfQlJPV1NFUl9QQUNLQUdFX0FDVElWSVRZLmRlZmF1bHQ7XG59O1xuXG5oZWxwZXJzLnJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyA9IGFzeW5jIGZ1bmN0aW9uIHJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyAoc2VydmVyLCBzZXNzaW9uSWQpIHtcbiAgaWYgKCFzZXJ2ZXIgfHwgIV8uaXNGdW5jdGlvbihzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMpKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgYWN0aXZlSGFuZGxlcnMgPSBhd2FpdCBzZXJ2ZXIuZ2V0V2ViU29ja2V0SGFuZGxlcnMoc2Vzc2lvbklkKTtcbiAgZm9yIChjb25zdCBwYXRobmFtZSBvZiBfLmtleXMoYWN0aXZlSGFuZGxlcnMpKSB7XG4gICAgYXdhaXQgc2VydmVyLnJlbW92ZVdlYlNvY2tldEhhbmRsZXIocGF0aG5hbWUpO1xuICB9XG59O1xuXG4vKipcbiAqIFRha2VzIGEgZGVzaXJlZCBjYXBhYmlsaXR5IGFuZCB0cmllcyB0byBKU09OLnBhcnNlIGl0IGFzIGFuIGFycmF5LFxuICogYW5kIGVpdGhlciByZXR1cm5zIHRoZSBwYXJzZWQgYXJyYXkgb3IgYSBzaW5nbGV0b24gYXJyYXkuXG4gKlxuICogQHBhcmFtIHthbnl9IGNhcCBBIGRlc2lyZWQgY2FwYWJpbGl0eVxuICovXG5oZWxwZXJzLnBhcnNlQXJyYXkgPSBmdW5jdGlvbiBwYXJzZUFycmF5IChjYXApIHtcbiAgbGV0IHBhcnNlZENhcHM7XG4gIHRyeSB7XG4gICAgcGFyc2VkQ2FwcyA9IEpTT04ucGFyc2UoY2FwKTtcbiAgfSBjYXRjaCAoaWduKSB7IH1cblxuICBpZiAoXy5pc0FycmF5KHBhcnNlZENhcHMpKSB7XG4gICAgcmV0dXJuIHBhcnNlZENhcHM7XG4gIH0gZWxzZSBpZiAoXy5pc1N0cmluZyhjYXApKSB7XG4gICAgcmV0dXJuIFtjYXBdO1xuICB9XG5cbiAgdGhyb3cgbmV3IEVycm9yKGBtdXN0IHByb3ZpZGUgYSBzdHJpbmcgb3IgSlNPTiBBcnJheTsgcmVjZWl2ZWQgJHtjYXB9YCk7XG59O1xuXG4vKipcbiAqIFZhbGlkYXRlIGRlc2lyZWQgY2FwYWJpbGl0aWVzLiBSZXR1cm5zIHRydWUgaWYgY2FwYWJpbGl0eSBpcyB2YWxpZFxuICpcbiAqIEBwYXJhbSB7Kn0gY2FwIEEgZGVzaXJlZCBjYXBhYmlsaXR5XG4gKiBAcmV0dXJuIHtib29sZWFufSBSZXR1cm5zIHRydWUgaWYgdGhlIGNhcGFiaWxpdHkgaXMgdmFsaWRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY2FwcyBoYXMgaW52YWxpZCBjYXBhYmlsaXR5XG4gKi9cbmhlbHBlcnMudmFsaWRhdGVEZXNpcmVkQ2FwcyA9IGZ1bmN0aW9uIHZhbGlkYXRlRGVzaXJlZENhcHMgKGNhcHMpIHtcbiAgaWYgKGNhcHMuYnJvd3Nlck5hbWUpIHtcbiAgICBpZiAoY2Fwcy5hcHApIHtcbiAgICAgIC8vIHdhcm4gaWYgdGhlIGNhcGFiaWxpdGllcyBoYXZlIGJvdGggYGFwcGAgYW5kIGBicm93c2VyLCBhbHRob3VnaCB0aGlzIGlzIGNvbW1vbiB3aXRoIHNlbGVuaXVtIGdyaWRcbiAgICAgIGxvZ2dlci53YXJuKGBUaGUgZGVzaXJlZCBjYXBhYmlsaXRpZXMgc2hvdWxkIGdlbmVyYWxseSBub3QgaW5jbHVkZSBib3RoIGFuICdhcHAnIGFuZCBhICdicm93c2VyTmFtZSdgKTtcbiAgICB9XG4gICAgaWYgKGNhcHMuYXBwUGFja2FnZSkge1xuICAgICAgbG9nZ2VyLmVycm9yQW5kVGhyb3coYFRoZSBkZXNpcmVkIHNob3VsZCBub3QgaW5jbHVkZSBib3RoIG9mIGFuICdhcHBQYWNrYWdlJyBhbmQgYSAnYnJvd3Nlck5hbWUnYCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGNhcHMudW5pbnN0YWxsT3RoZXJQYWNrYWdlcykge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnBhcnNlQXJyYXkoY2Fwcy51bmluc3RhbGxPdGhlclBhY2thZ2VzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBsb2dnZXIuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IHBhcnNlIFwidW5pbnN0YWxsT3RoZXJQYWNrYWdlc1wiIGNhcGFiaWxpdHk6ICR7ZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcblxuLyoqXG4gKiBBZGp1c3QgdGhlIGNhcGFiaWxpdGllcyBmb3IgYSBicm93c2VyIHNlc3Npb25cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gY2FwcyAtIEN1cnJlbnQgY2FwYWJpbGl0aWVzIG9iamVjdFxuICogISEhIFRoZSBvYmplY3QgaXMgbXV0YXRlZCBieSB0aGlzIG1ldGhvZCBjYWxsICEhIVxuICogQHJldHVybnMge09iamVjdH0gVGhlIHNhbWUgcG9zc2libHkgbXV0YXRlZCBgb3B0c2AgaW5zdGFuY2UuXG4gKiBObyBtdXRhdGlvbiBpcyBoYXBwZW5pbmcgaXMgdGhlIGN1cnJlbnQgc2Vzc2lvbiBpZlxuICogYXBwUGFja2FnZS9hcHBBY3Rpdml0eSBjYXBzIGhhdmUgYWxyZWFkeSBiZWVuIHByb3ZpZGVkLlxuICovXG5oZWxwZXJzLmFkanVzdEJyb3dzZXJTZXNzaW9uQ2FwcyA9IGZ1bmN0aW9uIGFkanVzdEJyb3dzZXJTZXNzaW9uQ2FwcyAoY2FwcyA9IHt9KSB7XG4gIGNvbnN0IHsgYnJvd3Nlck5hbWUgfSA9IGNhcHM7XG4gIGxvZ2dlci5pbmZvKGBUaGUgY3VycmVudCBzZXNzaW9uIGlzIGNvbnNpZGVyZWQgYnJvd3Nlci1iYXNlZGApO1xuICBsb2dnZXIuaW5mbyhgU3VwcG9ydGVkIGJyb3dzZXIgbmFtZXM6ICR7SlNPTi5zdHJpbmdpZnkoXy5rZXlzKENIUk9NRV9CUk9XU0VSX1BBQ0tBR0VfQUNUSVZJVFkpKX1gKTtcbiAgaWYgKGNhcHMuYXBwUGFja2FnZSB8fCBjYXBzLmFwcEFjdGl2aXR5KSB7XG4gICAgbG9nZ2VyLmluZm8oYE5vdCBvdmVycmlkaW5nIGFwcFBhY2thZ2UvYXBwQWN0aXZpdHkgY2FwYWJpbGl0eSB2YWx1ZXMgZm9yICcke2Jyb3dzZXJOYW1lfScgYCArXG4gICAgICAnYmVjYXVzZSBzb21lIG9mIHRoZW0gaGF2ZSBiZWVuIGFscmVhZHkgcHJvdmlkZWQnKTtcbiAgICByZXR1cm4gY2FwcztcbiAgfVxuXG4gIGNvbnN0IHtwa2csIGFjdGl2aXR5fSA9IHRoaXMuZ2V0Q2hyb21lUGtnKGJyb3dzZXJOYW1lKTtcbiAgY2Fwcy5hcHBQYWNrYWdlID0gcGtnO1xuICBjYXBzLmFwcEFjdGl2aXR5ID0gYWN0aXZpdHk7XG4gIGxvZ2dlci5pbmZvKGBhcHBQYWNrYWdlL2FwcEFjdGl2aXR5IGNhcGFiaWxpdGllcyBoYXZlIGJlZW4gYXV0b21hdGljYWxseSBzZXQgdG8gJHtwa2d9LyR7YWN0aXZpdHl9IGAgK1xuICAgIGBmb3IgJyR7YnJvd3Nlck5hbWV9J2ApO1xuICBsb2dnZXIuaW5mbyhgQ29uc2lkZXIgY2hhbmdpbmcgdGhlIGJyb3dzZXJOYW1lIHRvIHRoZSBvbmUgZnJvbSB0aGUgbGlzdCBvZiBzdXBwb3J0ZWQgYnJvd3NlciBuYW1lcyBgICtcbiAgICBgb3IgcHJvdmlkZSBjdXN0b20gYXBwUGFja2FnZS9hcHBBY3Rpdml0eSBjYXBhYmlsaXR5IHZhbHVlcyBpZiB0aGUgYXV0b21hdGljYWxseSBhc3NpZ25lZCBvbmVzIGRvIGAgK1xuICAgIGBub3QgbWFrZSBzZW5zZWApO1xuICByZXR1cm4gY2Fwcztcbn07XG5cbi8qKlxuICogQ2hlY2tzIHdoZXRoZXIgdGhlIGN1cnJlbnQgZGV2aWNlIHVuZGVyIHRlc3QgaXMgYW4gZW11bGF0b3JcbiAqXG4gKiBAcGFyYW0ge0FEQn0gYWRiIC0gYXBwaXVtLWFkYiBpbnN0YW5jZVxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMgLSBkcml2ZXIgb3B0aW9ucyBtYXBwaW5nXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIHRoZSBkZXZpY2UgaXMgYW4gQW5kcm9pZCBlbXVsYXRvclxuICovXG5oZWxwZXJzLmlzRW11bGF0b3IgPSBmdW5jdGlvbiBpc0VtdWxhdG9yIChhZGIsIG9wdHMpIHtcbiAgY29uc3QgcG9zc2libGVOYW1lcyA9IFtvcHRzLnVkaWQsIGFkYj8uY3VyRGV2aWNlSWRdO1xuICByZXR1cm4gISFvcHRzLmF2ZCB8fCBwb3NzaWJsZU5hbWVzLnNvbWUoKHgpID0+IEVNVUxBVE9SX1BBVFRFUk4udGVzdCh4KSk7XG59O1xuXG5oZWxwZXJzLmJvb3RzdHJhcCA9IEJvb3RzdHJhcDtcbmhlbHBlcnMudW5sb2NrZXIgPSB1bmxvY2tlcjtcblxuZXhwb3J0IHsgaGVscGVycywgU0VUVElOR1NfSEVMUEVSX1BLR19JRCB9O1xuZXhwb3J0IGRlZmF1bHQgaGVscGVycztcbiJdLCJmaWxlIjoibGliL2FuZHJvaWQtaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
